<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="gr__bamos_github_io" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>Image Completion with Deep Learning in TensorFlow</title>

  <meta name="author" content="Brandon Amos">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="https://bamos.github.io/atom.xml">

  <style class="anchorjs"></style><link href="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/bootstrap.css" rel="stylesheet">
  <link href="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/font-awesome.css" rel="stylesheet">
  <link href="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/academicons.css" rel="stylesheet">
  <link href="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/default.css" rel="stylesheet">
  <link href="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/bamos.css" rel="stylesheet">
  <link href="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/sharingbuttons.css" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body data-gr-c-s-loaded="true"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
	<div class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="row">
				<div class="col-md-10 col-md-offset-1">
					<div class="navbar-header">
						  <a href="https://bamos.github.io/" class="navbar-brand">
                  <div>
                      <img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/me-face.png" class="img-circle">
                      Brandon Amos
                  </div>
              </a>
						<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
					</div>
					<div class="navbar-collapse collapse" id="navbar-main">
						<ul class="nav navbar-nav">
							<li>
								<a href="https://bamos.github.io/">About</a>
							</li>
							<li>
								<a href="https://bamos.github.io/blog/">Blog</a>
							</li>
						</ul>
						<ul class="nav navbar-nav navbar-right" style="font-size: 1.5em">
							<li>
								<a href="http://github.com/bamos" target="_blank">
									<i class="fa fa-lg fa-github"></i></a>
							</li>
							<li>
								<a href="http://twitter.com/brandondamos" target="_blank">
									<i class="fa fa-lg fa-twitter"></i></a>
							</li>
              <li>
                <a href="https://scholar.google.com/citations?user=d8gdZR4AAAAJ" target="_blank">
                  <i class="ai ai-google-scholar"></i></a>
              </li>
              <li>
                  <a href="https://bamos.github.io/atom.xml" target="_blank">
                      <i class="fa fa-rss"></i></a>
              </li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

  <br>
<div class="container">
<div class="row">
<div class="col-md-10 col-md-offset-1">
  <h1>Image Completion with Deep Learning in TensorFlow</h1>
<em>August  9, 2016</em>
<br>

<!-- From: http://sharingbuttons.io/ -->

<!-- Sharingbutton Twitter -->
<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow%20by%20@brandondamos%20&amp;url=http://bamos.github.io/2016/08/09/deep-completion/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M23.444,4.834c-0.814,0.363-1.5,0.375-2.228,0.016c0.938-0.562,0.981-0.957,1.32-2.019c-0.878,0.521-1.851,0.9-2.886,1.104 C18.823,3.053,17.642,2.5,16.335,2.5c-2.51,0-4.544,2.036-4.544,4.544c0,0.356,0.04,0.703,0.117,1.036 C8.132,7.891,4.783,6.082,2.542,3.332C2.151,4.003,1.927,4.784,1.927,5.617c0,1.577,0.803,2.967,2.021,3.782 C3.203,9.375,2.503,9.171,1.891,8.831C1.89,8.85,1.89,8.868,1.89,8.888c0,2.202,1.566,4.038,3.646,4.456 c-0.666,0.181-1.368,0.209-2.053,0.079c0.579,1.804,2.257,3.118,4.245,3.155C5.783,18.102,3.372,18.737,1,18.459 C3.012,19.748,5.399,20.5,7.966,20.5c8.358,0,12.928-6.924,12.928-12.929c0-0.198-0.003-0.393-0.012-0.588 C21.769,6.343,22.835,5.746,23.444,4.834z"></path>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Facebook -->
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http://bamos.github.io/2016/08/09/deep-completion/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"></path>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Google+ -->
<a class="resp-sharing-button__link" href="https://plus.google.com/share?url=http://bamos.github.io/2016/08/09/deep-completion/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M11.366,12.928c-0.729-0.516-1.393-1.273-1.404-1.505c0-0.425,0.038-0.627,0.988-1.368 c1.229-0.962,1.906-2.228,1.906-3.564c0-1.212-0.37-2.289-1.001-3.044h0.488c0.102,0,0.2-0.033,0.282-0.091l1.364-0.989 c0.169-0.121,0.24-0.338,0.176-0.536C14.102,1.635,13.918,1.5,13.709,1.5H7.608c-0.667,0-1.345,0.118-2.011,0.347 c-2.225,0.766-3.778,2.66-3.778,4.605c0,2.755,2.134,4.845,4.987,4.91c-0.056,0.22-0.084,0.434-0.084,0.645 c0,0.425,0.108,0.827,0.33,1.216c-0.026,0-0.051,0-0.079,0c-2.72,0-5.175,1.334-6.107,3.32C0.623,17.06,0.5,17.582,0.5,18.098 c0,0.501,0.129,0.984,0.382,1.438c0.585,1.046,1.843,1.861,3.544,2.289c0.877,0.223,1.82,0.335,2.8,0.335 c0.88,0,1.718-0.114,2.494-0.338c2.419-0.702,3.981-2.482,3.981-4.538C13.701,15.312,13.068,14.132,11.366,12.928z M3.66,17.443 c0-1.435,1.823-2.693,3.899-2.693h0.057c0.451,0.005,0.892,0.072,1.309,0.2c0.142,0.098,0.28,0.192,0.412,0.282 c0.962,0.656,1.597,1.088,1.774,1.783c0.041,0.175,0.063,0.35,0.063,0.519c0,1.787-1.333,2.693-3.961,2.693 C5.221,20.225,3.66,19.002,3.66,17.443z M5.551,3.89c0.324-0.371,0.75-0.566,1.227-0.566l0.055,0 c1.349,0.041,2.639,1.543,2.876,3.349c0.133,1.013-0.092,1.964-0.601,2.544C8.782,9.589,8.363,9.783,7.866,9.783H7.865H7.844 c-1.321-0.04-2.639-1.6-2.875-3.405C4.836,5.37,5.049,4.462,5.551,3.89z"></path>
            <polygon points="23.5,9.5 20.5,9.5 20.5,6.5 18.5,6.5 18.5,9.5 15.5,9.5 15.5,11.5 18.5,11.5 18.5,14.5 20.5,14.5 20.5,11.5  23.5,11.5 	"></polygon>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton LinkedIn -->
<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://bamos.github.io/2016/08/09/deep-completion/&amp;title=Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow&amp;summary=Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow&amp;source=http://bamos.github.io/2016/08/09/deep-completion/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M6.527,21.5h-5v-13h5V21.5z M4.018,6.5H3.988C2.478,6.5,1.5,5.318,1.5,4.019c0-1.329,1.008-2.412,2.547-2.412 c1.541,0,2.488,1.118,2.519,2.447C6.565,5.354,5.588,6.5,4.018,6.5z M15.527,12.5c-1.105,0-2,0.896-2,2v7h-5c0,0,0.059-12,0-13h5 v1.485c0,0,1.548-1.443,3.938-1.443c2.962,0,5.062,2.144,5.062,6.304V21.5h-5v-7C17.527,13.396,16.632,12.5,15.527,12.5z"></path>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Reddit -->
<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=http://bamos.github.io/2016/08/09/deep-completion/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <path d="M24,11.5c0-1.654-1.346-3-3-3c-0.964,0-1.863,0.476-2.422,1.241c-1.639-1.006-3.747-1.64-6.064-1.723 c0.064-1.11,0.4-3.049,1.508-3.686c0.72-0.414,1.733-0.249,3.01,0.478C17.189,6.317,18.452,7.5,20,7.5c1.654,0,3-1.346,3-3 s-1.346-3-3-3c-1.382,0-2.536,0.944-2.883,2.217C15.688,3,14.479,2.915,13.521,3.466c-1.642,0.945-1.951,3.477-2.008,4.551 C9.186,8.096,7.067,8.731,5.422,9.741C4.863,8.976,3.964,8.5,3,8.5c-1.654,0-3,1.346-3,3c0,1.319,0.836,2.443,2.047,2.844 C2.019,14.56,2,14.778,2,15c0,3.86,4.486,7,10,7s10-3.14,10-7c0-0.222-0.019-0.441-0.048-0.658C23.148,13.938,24,12.795,24,11.5z  M2.286,13.366C1.522,13.077,1,12.351,1,11.5c0-1.103,0.897-2,2-2c0.635,0,1.217,0.318,1.59,0.816 C3.488,11.17,2.683,12.211,2.286,13.366z M6,13.5c0-1.103,0.897-2,2-2s2,0.897,2,2c0,1.103-0.897,2-2,2S6,14.603,6,13.5z  M15.787,18.314c-1.063,0.612-2.407,0.949-3.787,0.949c-1.387,0-2.737-0.34-3.803-0.958c-0.239-0.139-0.321-0.444-0.182-0.683 c0.139-0.24,0.444-0.322,0.683-0.182c1.828,1.059,4.758,1.062,6.59,0.008c0.239-0.138,0.545-0.055,0.683,0.184 C16.108,17.871,16.026,18.177,15.787,18.314z M16,15.5c-1.103,0-2-0.897-2-2c0-1.103,0.897-2,2-2s2,0.897,2,2 C18,14.603,17.103,15.5,16,15.5z M21.713,13.365c-0.397-1.155-1.201-2.195-2.303-3.048C19.784,9.818,20.366,9.5,21,9.5 c1.103,0,2,0.897,2,2C23,12.335,22.468,13.073,21.713,13.365z"></path>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton E-Mail -->
<a class="resp-sharing-button__link" href="mailto:?subject=Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow&amp;body=http://bamos.github.io/2016/08/09/deep-completion/" target="_self" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <path d="M22,4H2C0.897,4,0,4.897,0,6v12c0,1.103,0.897,2,2,2h20c1.103,0,2-0.897,2-2V6C24,4.897,23.103,4,22,4z M7.248,14.434 l-3.5,2C3.67,16.479,3.584,16.5,3.5,16.5c-0.174,0-0.342-0.09-0.435-0.252c-0.137-0.239-0.054-0.545,0.186-0.682l3.5-2 c0.24-0.137,0.545-0.054,0.682,0.186C7.571,13.992,7.488,14.297,7.248,14.434z M12,14.5c-0.094,0-0.189-0.026-0.271-0.08l-8.5-5.5 C2.997,8.77,2.93,8.46,3.081,8.229c0.15-0.23,0.459-0.298,0.691-0.147L12,13.405l8.229-5.324c0.232-0.15,0.542-0.084,0.691,0.147 c0.15,0.232,0.083,0.542-0.148,0.691l-8.5,5.5C12.189,14.474,12.095,14.5,12,14.5z M20.934,16.248 C20.842,16.41,20.673,16.5,20.5,16.5c-0.084,0-0.169-0.021-0.248-0.065l-3.5-2c-0.24-0.137-0.323-0.442-0.186-0.682 s0.443-0.322,0.682-0.186l3.5,2C20.988,15.703,21.071,16.009,20.934,16.248z"></path>
    </svg>
    </div>
  </div>
</a>


<hr style="margin-top: 0;">

<script async="" src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/analytics.js"></script><script type="text/x-mathjax-config;executed=true">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<script type="text/javascript" async="" src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/MathJax.js">
</script>

<ul id="toc"><li><a href="#introduction">Introduction</a></li><li><a href="#step-1-interpreting-images-as-samples-from-a-probability-distribution">Step 1: Interpreting images as samples from a probability distribution</a><ul><li><a href="#how-would-you-fill-in-the-missing-information">How would you fill in the missing information?</a></li><li><a href="#but-where-does-statistics-fit-in-these-are-images">But where does statistics fit in? These are images.</a></li><li><a href="#so-how-can-we-complete-images">So how can we complete images?</a></li></ul></li><li><a href="#step-2-quickly-generating-fake-images">Step 2: Quickly generating fake images</a><ul><li><a href="#learning-to-generate-new-samples-from-an-unknown-probability-distribution">Learning to generate new samples from an unknown probability distribution</a></li><li><a href="#ml-heavy-generative-adversarial-net-gan-building-blocks">[ML-Heavy] Generative Adversarial Net (GAN) building blocks</a></li><li><a href="#using-gz-to-produce-fake-images">Using <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-6" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">G(z)</script> to produce fake images</a></li><li><a href="#ml-heavy-training-dcgans">[ML-Heavy] Training DCGANs</a></li><li><a href="#existing-gan-and-dcgan-implementations">Existing GAN and DCGAN implementations</a></li><li><a href="#ml-heavy-dcgans-in-tensorflow">[ML-Heavy] DCGANs in TensorFlow</a></li><li><a href="#running-dcgan-on-your-images">Running DCGAN on your images</a></li></ul></li><li><a href="#step-3-finding-the-best-fake-image-for-image-completion">Step 3: Finding the best fake image for image completion</a><ul><li><a href="#image-completion-with-dcgans">Image completion with DCGANs</a></li><li><a href="#ml-heavy-loss-function-for-projecting-onto-p_g">[ML-Heavy] Loss function for projecting onto <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="msubsup" id="MathJax-Span-9"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-10" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-11" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2">p_g</script></a></li><li><a href="#ml-heavy-tensorflow-implementation-of-image-completion-with-dcgans">[ML-Heavy] TensorFlow implementation of image completion with DCGANs</a></li><li><a href="#completing-your-images">Completing your images</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#citation-for-this-articleproject">Citation for this article/project</a></li><li><a href="#partial-bibliography-for-further-reading">Partial bibliography for further reading</a></li><li><a href="#bonus-incomplete-thoughts-on-tensorflow-and-torch">Bonus: Incomplete Thoughts on TensorFlow and Torch</a></li></ul>

<hr>

<h2 id="introduction">Introduction<a class="anchorjs-link " href="#introduction" aria-label="Anchor link for: introduction" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>

<p>Content-aware fill is a powerful tool designers and photographers
use to fill in unwanted or missing parts of images.
Image completion and <a href="https://en.wikipedia.org/wiki/Inpainting">inpainting</a>
are closely related technologies used to fill in
missing or corrupted parts of images.
There are many ways to do content-aware fill,
image completion, and inpainting.
In this blog post, I present Raymond Yeh and Chen Chen et al.’s paper
“<a href="https://arxiv.org/abs/1607.07539">Semantic Image Inpainting with Perceptual and Contextual Losses</a>,”
which was just posted on arXiv on July 26, 2016.
This paper shows how to use deep learning for image completion with
a <a href="https://arxiv.org/abs/1511.06434">DCGAN</a>.
This blog post is meant for a general technical audience with some deeper
portions for people with a machine learning background.
I’ve added <code class="highlighter-rouge">[ML-Heavy]</code> tags to sections to indicate that the section
can be skipped if you don’t want too many details.
We will only look at the constrained case of completing missing
pixels from images of faces.
I have released all of the <a href="https://www.tensorflow.org/">TensorFlow</a>
source code behind this post on GitHub at
<a href="https://github.com/bamos/dcgan-completion.tensorflow">bamos/dcgan-completion.tensorflow</a>.</p>

<p>We’ll approach image completion in three steps.</p>

<ol>
  <li><a href="#step-1-interpreting-images-as-samples-from-a-probability-distribution">We’ll first interpret images as being samples from a probability distribution</a>.</li>
  <li><a href="#step-2-quickly-generating-fake-images">This interpretation lets us learn how to generate fake images</a>.</li>
  <li><a href="#step-3-using-fake-image-generation-for-image-completion">Then we’ll find the best fake image for completion</a>.</li>
</ol>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/content-aware-1.jpg" alt=""></p>

  <p class="image-caption">Photoshop example of automatically filling in missing image parts. (Image CC licensed, <a href="https://flic.kr/p/7Ye6Sj">source</a>.)</p>

</div>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/content-aware-2.jpg" alt=""></p>

  <p class="image-caption">Photoshop example of automatically removing unwanted image parts. (Image CC licensed, <a href="https://flic.kr/p/8fh3Vb">source</a>.)</p>

</div>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/completion.gif" alt=""></p>

  <p class="image-caption">
    Completions generated by what we’ll cover in this blog post.
    The centers of these images are being automatically generated.
    The source code to create this is available <a href="http://github.com/bamos/dcgan-completion.tensorflow">here</a>.
    <strong>These are not curated!</strong> I selected a random subset of images
    from the LFW dataset.</p>

</div>

<hr>

<h2 id="step-1-interpreting-images-as-samples-from-a-probability-distribution">Step 1: Interpreting images as samples from a probability distribution<a class="anchorjs-link " href="#step-1-interpreting-images-as-samples-from-a-probability-distribution" aria-label="Anchor link for: step 1 interpreting images as samples from a probability distribution" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>

<h3 id="how-would-you-fill-in-the-missing-information">How would you fill in the missing information?<a class="anchorjs-link " href="#how-would-you-fill-in-the-missing-information" aria-label="Anchor link for: how would you fill in the missing information" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>In the examples above, imagine you’re building a system to
fill in the missing pieces.
<em>How would you do it?
How do you think the human brain does it?
What kind of information would you use?</em></p>

<p>In this post we will focus on two types of information:</p>

<ol>
  <li><strong>Contextual information:</strong> You can infer what
missing pixels are based on information provided
by surrounding pixels.</li>
  <li><strong>Perceptual information:</strong> You interpret the
filled in portions as being “normal,” like from what
you’ve seen in real life or from other pictures.</li>
</ol>

<p>Both of these are important.
Without contextual information, how do you know what to fill in?
Without perceptual information, there are many valid completions
for a context. Something that looks “normal” to a machine learning
system might not look normal to humans.</p>

<p>It would be nice to have an exact, intuitive algorithm that
captures both of these properties that says step-by-step how
to complete an image.
Creating such an algorithm may be possible for specific cases,
but in general, nobody knows how.
Today’s best approaches use statistics and machine learning
to learn an <em>approximate</em> technique.</p>

<h3 id="but-where-does-statistics-fit-in-these-are-images">But where does statistics fit in? These are images.<a class="anchorjs-link " href="#but-where-does-statistics-fit-in-these-are-images" aria-label="Anchor link for: but where does statistics fit in these are images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>To motivate the problem, let’s start by looking at a
<a href="https://en.wikipedia.org/wiki/Probability_distribution">probability distribution</a>
that is well-understood and can be represented concisely in closed form:
a <a href="https://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a>.
Here’s the <a href="https://en.wikipedia.org/wiki/Probability_density_function">probability density function</a> (PDF) for a normal distribution.
You can interpret the PDF as going over the <em>input</em> space horizontally
with the vertical axis showing the probability that some value occurs.
(If you’re interested, the code to create these plots is available at
<a href="https://github.com/bamos/dcgan-completion.tensorflow/blob/master/simple-distributions.py">bamos/dcgan-completion.tensorflow:simple-distributions.py</a>.)</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/normal-pdf.png" alt=""></p>

  <p class="image-caption">PDF for a normal distribution.</p>

</div>

<p>Let’s <em>sample</em> from the distribution to get some data.
Make sure you understand the connection between the
PDF and the samples.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/normal-samples.png" alt=""></p>

  <p class="image-caption">Samples from a normal distribution.</p>

</div>

<p>This is a 1D probability distribution because
the input only goes along a single dimension.
We can do the same thing in two dimensions.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/normal-2d.png" alt=""></p>

  <p class="image-caption">PDF and samples from a 2D normal distribution.
    The PDF is shown as a contour plot and the samples
    are overlaid.</p>

</div>

<p>The key relationship between images and statistics is that
<strong>we can interpret images as samples
from a high-dimensional probability distribution.</strong>
The probability distribution goes over the pixels of images.
Imagine you’re taking a picture with your camera.
This picture will have some finite number of pixels.
When you take an image with your camera, you are
sampling from this complex probability distribution.
This distribution is what we’ll use to define what
makes an image normal or not.
With images, unlike with the normal distributions, we <strong>don’t</strong> know
the true probability distribution and we can <strong>only</strong> collect samples.</p>

<p>In this post, we’ll use color images represented by the
<a href="https://en.wikipedia.org/wiki/RGB_color_model">RGB color model</a>.
Our images will be 64 pixels wide and 64 pixels high,
so our probability distribution has <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;64&lt;/mn&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mn&gt;64&lt;/mn&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;&amp;#x2248;&lt;/mo&gt;&lt;mn&gt;12&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-12" style="width: 7.761em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.681em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.461em, 1006.66em, 2.5em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-13"><span class="mn" id="MathJax-Span-14" style="font-family: MathJax_Main;">64</span><span class="mo" id="MathJax-Span-15" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mn" id="MathJax-Span-16" style="font-family: MathJax_Main; padding-left: 0.222em;">64</span><span class="mo" id="MathJax-Span-17" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mn" id="MathJax-Span-18" style="font-family: MathJax_Main; padding-left: 0.222em;">3</span><span class="mo" id="MathJax-Span-19" style="font-family: MathJax_Main; padding-left: 0.278em;">≈</span><span class="mn" id="MathJax-Span-20" style="font-family: MathJax_Main; padding-left: 0.278em;">12</span><span class="mi" id="MathJax-Span-21" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.956em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>64</mn><mo>⋅</mo><mn>64</mn><mo>⋅</mo><mn>3</mn><mo>≈</mo><mn>12</mn><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">64\cdot 64\cdot 3 \approx 12k</script> dimensions.</p>

<h3 id="so-how-can-we-complete-images">So how can we complete images?<a class="anchorjs-link " href="#so-how-can-we-complete-images" aria-label="Anchor link for: so how can we complete images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>Let’s first consider the multivariate normal distribution from before for intuition.
Given <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-22" style="width: 2.751em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.371em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.489em, 1002.3em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-23"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-25" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-26" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.91em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">x=1</script>, what is the most probable <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-27" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">y</script> value?
We can find this by maximizing the value of the PDF over
all possible <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-30" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-31"><span class="mi" id="MathJax-Span-32" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">y</script> values with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-33" style="width: 2.751em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.371em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.489em, 1002.3em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-34"><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-37" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.91em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-7">x=1</script> fixed.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/normal-2d-max.png" alt=""></p>

  <p class="image-caption">Finding the most probable <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-38" style="width: 0.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.638em, 1000.52em, 2.806em, -1000em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-39"><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.34em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.845em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">y</script> value given some fixed <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 0.611em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.607em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.638em, 1000.56em, 2.612em, -1000em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.34em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.101em; border-left: 0px solid; width: 0px; height: 0.645em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">x</script>
   in a multivariate normal distribution.</p>

</div>

<p>This concept naturally extends to our image probability distribution
when we know some values and want to complete the missing values.
Just pose it as a maximization problem where we search over all
of the possible missing values.
The completion will be the most probable image.</p>

<p>Visually looking at the samples from the normal distribution,
it seems reasonable that we could find the PDF given
only samples. Just pick your favorite
<a href="https://en.wikipedia.org/wiki/Statistical_model">statistical model</a>
and fit it to the data.</p>

<p>However we don’t use this method in practice.
While the PDF is easy to recover for simple distributions,
it’s difficult and often intractable for more complex
distributions over images.
The complexity partly comes from intricate
<a href="https://en.wikipedia.org/wiki/Conditional_dependence">conditional dependencies</a>:
the value of one pixel depends on the values of other pixels in the image.
Also, maximizing over a general PDF is an extremely difficult
and often intractable non-convex optimization problem.</p>

<h2 id="step-2-quickly-generating-fake-images">Step 2: Quickly generating fake images<a class="anchorjs-link " href="#step-2-quickly-generating-fake-images" aria-label="Anchor link for: step 2 quickly generating fake images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>

<h3 id="learning-to-generate-new-samples-from-an-unknown-probability-distribution">Learning to generate new samples from an unknown probability distribution<a class="anchorjs-link " href="#learning-to-generate-new-samples-from-an-unknown-probability-distribution" aria-label="Anchor link for: learning to generate new samples from an unknown probability distribution" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>Instead of learning how to compute the PDF, another well-studied
idea in statistics is to learn how to generate new (random)
samples with a
<a href="https://en.wikipedia.org/wiki/Generative_model">generative model</a>.
Generative models can often be difficult to train or intractable,
but lately the deep learning community has made some
amazing progress in this space.
<a href="http://yann.lecun.com/">Yann LeCun</a> gives a great introduction to
one way of training generative models (adversarial training) in
<a href="https://www.quora.com/What-are-some-recent-and-potentially-upcoming-breakthroughs-in-deep-learning/answer/Yann-LeCun?srid=nZuy">this Quora post</a>,
describing the idea as the most interesting idea in the last
10 years in machine learning:</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/lecun-quora.png" alt=""></p>

  <p class="image-caption"><a href="http://yann.lecun.com/">Yann LeCun’s</a> introduction to
   adversarial training from
  <a href="https://www.quora.com/What-are-some-recent-and-potentially-upcoming-breakthroughs-in-deep-learning/answer/Yann-LeCun?srid=nZuy">this Quora post</a>.</p>

</div>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/Street_Fighter_II_arcade_screenshot.png" alt=""></p>

  <p class="image-caption">Street Fighter analogy for adversarial networks
   from the <a href="http://soumith.ch/eyescream/">EyeScream post</a>.
   The networks fight each other and improve together,
   like two humans playing against each other in a game.
   <a href="https://en.wikipedia.org/wiki/Street_Fighter#/media/File:Street_Fighter_II_(arcade)_screenshot.png">Image source</a>.</p>

</div>

<p>There are other ways to train generative models with deep learning,
like <a href="http://arxiv.org/abs/1312.6114">Variational Autoencoders</a> (VAEs).
In this post we’ll only focus on Generative Adversarial Nets (GANs).</p>

<h3 id="ml-heavy-generative-adversarial-net-gan-building-blocks">[ML-Heavy] Generative Adversarial Net (GAN) building blocks<a class="anchorjs-link " href="#ml-heavy-generative-adversarial-net-gan-building-blocks" aria-label="Anchor link for: ml heavy generative adversarial net gan building blocks" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>These ideas started with Ian Goodfellow et al.’s landmark paper
“<a href="http://papers.nips.cc/paper/5423-generative-adversarial">Generative Adversarial Nets</a>”
(GANs),
published at the <a href="https://nips.cc/">Neural Information Processing Systems (NIPS)</a>
conference in 2014.
The idea is that we define a simple, well-known distribution
and represent it as <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-44" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-45"><span class="msubsup" id="MathJax-Span-46"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-48" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-10">p_z</script>.
For the rest of this post, we’ll use <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="msubsup" id="MathJax-Span-51"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-53" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">p_z</script> as a uniform distribution
between -1 and 1 (inclusively).
We represent sampling a number from this distribution as
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-54" style="width: 3.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.694em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1002.69em, 2.672em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-55"><span class="mi" id="MathJax-Span-56" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="msubsup" id="MathJax-Span-58" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-60" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∼</mo><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-12">z\sim p_z</script>.
If <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-61" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-62"><span class="msubsup" id="MathJax-Span-63"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-65" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-13">p_z</script> is 5-dimensional, we can sample it with one
line of Python with <a href="http://www.numpy.org/">numpy</a>:</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">0.77356483</span><span class="p">,</span>  <span class="mf">0.95258473</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.18345086</span><span class="p">,</span>  <span class="mf">0.69224724</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.34718733</span><span class="p">])</span></code></pre>
</figure>

<p>Now this we have a simple distribution we can easily sample from,
we’d like to define a function <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-66" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-67"><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-69" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-70" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-71" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-14">G(z)</script> that produces samples
from our original probability distribution.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">imageSample</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">imageSample</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></code></pre>
</figure>

<p>So how do we define <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-72" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-73"><span class="mi" id="MathJax-Span-74" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-75" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-76" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-77" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-15">G(z)</script> so that it takes a vector on input
and returns an image? We’ll use a deep neural network.
There are many great introductions to deep neural network basics,
so I won’t cover them here.
Some great references that I recommend are
<a href="http://cs231n.github.io/">Stanford’s CS231n course</a>,
Ian Goodfellow et al.’s <a href="http://www.deeplearningbook.org/">Deep Learning Book</a>,
<a href="http://setosa.io/ev/image-kernels/">Image Kernels Explained Visually</a>, and
<a href="https://arxiv.org/abs/1603.07285">convolution arithmetic guide</a>.</p>

<p>There are many ways we can structure <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-78" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-79"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-81" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-83" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-16">G(z)</script> with deep learning.
The original GAN paper proposed the idea, a training procedure,
and preliminary experimental results.
The idea has been greatly built on and improved.
One of the most recent ideas was presented in the paper
“<a href="https://arxiv.org/abs/1511.06434">Unsupervised Representation Learning with Deep Convolutional Generative Adversarial Networks</a>” by
Alec Radford, Luke Metz, and Soumith Chintala at the
<a href="http://www.iclr.cc/">International Conference on Learning Representations</a>
(ICLR, pronounced “eye-clear”) in 2016.
This paper presents deep convolutional GANs (called DCGANs)
that use <em>fractionally-strided</em> convolutions to <em>upsample</em> images.</p>

<p><em>What is a fractionally-strided convolution and how do they upsample images?</em>
Vincent Dumoulin and Francesco Visin’s paper
“<a href="https://arxiv.org/abs/1603.07285">A guide to convolution arithmetic for deep learning</a>”
and <a href="https://github.com/vdumoulin/conv_arithmetic">conv_arithmetic</a> project
is a very well-written introduction to convolution arithmetic in deep learning.
The visualizations are amazing and give great intuition into how
fractionally-strided convolutions work.
First, make sure you understand how a normal convolution slides a kernel
over a (blue) input space to produce the (green) output space.
Here, the output is smaller than the input.
(If you don’t, go through
<a href="http://cs231n.github.io/convolutional-networks/">the CS231n CNN section</a> or the
<a href="https://arxiv.org/abs/1603.07285">convolution arithmetic guide</a>.)</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/padding_strides.gif" alt=""></p>

  <p class="image-caption">Illustration of a convolution from the input (blue) to output (green). This image is from <a href="https://github.com/vdumoulin/conv_arithmetic">vdumoulin/conv_arithmetic</a>.</p>

</div>

<p>Next, suppose that you have a 3x3 input.
Our goal is to upsample so that the output is larger.
You can interpret a fractionally-strided convolution as expanding
the pixels so that there are zeros in-between the pixels.
Then the convolution over this expanded space will
result in a larger output space.
Here, it’s 5x5.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/padding_strides_transposed.gif" alt=""></p>

  <p class="image-caption">Illustration of a fractionally-strided convolution from the input (blue) to output (green). This image is from <a href="https://github.com/vdumoulin/conv_arithmetic">vdumoulin/conv_arithmetic</a>.</p>

</div>

<p>As a side-note, there are many names for convolutional layers that upsample:
<a href="https://people.eecs.berkeley.edu/~jonlong/long_shelhamer_fcn.pdf">full convolution</a>,
in-network upsampling, fractionally-strided convolution,
backwards convolution, deconvolution, upconvolution, or
transposed convolution. Using the term ‘deconvolution’ for this is
strongly discouraged because it’s an over-loaded term:
<a href="https://en.wikipedia.org/wiki/Deconvolution">the mathematical operation</a>
or <a href="http://www.matthewzeiler.com/pubs/iccv2011/iccv2011.pdf">other uses in computer vision</a>
have a completely different meaning.</p>

<p>Now that we have fractionally-strided convolutions as building blocks,
we can finally represent <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-84" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-85"><span class="mi" id="MathJax-Span-86" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-87" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-88" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-89" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-17">G(z)</script> so that it takes a vector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-90" style="width: 3.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.694em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1002.69em, 2.672em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-91"><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="msubsup" id="MathJax-Span-94" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-95" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-96" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∼</mo><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-18">z\sim p_z</script>
on input and outputs a 64x64x3 RGB image.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/gen-architecture.png" alt=""></p>

  <p class="image-caption">One way to structure the generator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-97" style="width: 1.998em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.907em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.33em, 1001.81em, 2.851em, -1000em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-98"><span class="mi" id="MathJax-Span-99" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-100" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-102" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.34em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.347em; border-left: 0px solid; width: 0px; height: 1.209em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">G(z)</script> with a DCGAN.
   This image is from the <a href="https://arxiv.org/abs/1511.06434">DCGAN paper</a>.</p>

</div>

<p>The <a href="https://arxiv.org/abs/1511.06434">DCGAN paper</a> also presents
other tricks and modifications for training DCGANs like using
batch normalization or leaky ReLUs if you’re interested.</p>

<h3 id="using-gz-to-produce-fake-images">Using <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-103" style="width: 2.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.049em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.417em, 1001.95em, 2.654em, -1000em); top: -2.286em; left: 0em;"><span class="mrow" id="MathJax-Span-104"><span class="mi" id="MathJax-Span-105" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-106" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-107" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-108" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.286em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.353em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-20">G(z)</script> to produce fake images<a class="anchorjs-link " href="#using-gz-to-produce-fake-images" aria-label="Anchor link for: using gz to produce fake images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>Let’s pause and appreciate how powerful this formulation of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-109" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-110"><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-114" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-21">G(z)</script> is.
The <a href="https://arxiv.org/abs/1511.06434">DCGAN paper</a> showed how a
DCGAN can be trained on a dataset of bedroom images.
Then sampling <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-115" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-116"><span class="mi" id="MathJax-Span-117" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-118" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-119" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-22">G(z)</script> will produce the following fake images of
what the generator thinks bedrooms looks like.
<strong>None of these images are in the original dataset!</strong></p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/generated-bedrooms.png" alt=""></p>

  <p class="image-caption">Generating bedroom images with a DCGAN.
   This image is from the <a href="https://arxiv.org/abs/1511.06434">DCGAN paper</a>.</p>

</div>

<p>Also, you can perform vector arithmetic on the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-121" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-122"><span class="mi" id="MathJax-Span-123" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-23">z</script> input space.
The following is on a network trained to produce faces.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/face-arithmetic.png" alt=""></p>

  <p class="image-caption">Face arithmetic with DCGANs.
   This image is from the <a href="https://arxiv.org/abs/1511.06434">DCGAN paper</a>.</p>

</div>

<h3 id="ml-heavy-training-dcgans">[ML-Heavy] Training DCGANs<a class="anchorjs-link " href="#ml-heavy-training-dcgans" aria-label="Anchor link for: ml heavy training dcgans" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>Now that we have defined <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-124" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-125"><span class="mi" id="MathJax-Span-126" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-128" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-129" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-24">G(z)</script> and have seen how powerful the formulation is,
how do we train it?
We have a lot of <a href="https://en.wikipedia.org/wiki/Latent_variable">latent variables</a>
(or parameters)
that we need to find.
This is where using adversarial networks comes in.</p>

<p>First let’s define some notation.
Let the (unknown) probability distribution of our data be <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-130" style="width: 2.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.94em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1001.94em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-131"><span class="msubsup" id="MathJax-Span-132"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-133" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-134"><span class="mrow" id="MathJax-Span-135"><span class="mi" id="MathJax-Span-136" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-137" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-138" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-25">p_{\rm data}</script>.
Also we can interpret <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-140" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-141"><span class="mi" id="MathJax-Span-142" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-26">G(z)</script> (where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-146" style="width: 3.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.694em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1002.69em, 2.672em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-147"><span class="mi" id="MathJax-Span-148" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-149" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="msubsup" id="MathJax-Span-150" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-151" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-152" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∼</mo><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-27">z\sim p_z</script>) as drawing samples
from a probability distribution, let’s call it the generative
probability distribution, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-153" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-154"><span class="msubsup" id="MathJax-Span-155"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-156" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-157" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-28">p_g</script>.</p>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Probability Distribution Notation</th>
      <th>Meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-158" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-159"><span class="msubsup" id="MathJax-Span-160"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-161" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-162" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-29">p_z</script></td>
      <td>The (known, simple) distribution <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-163" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-164"><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-30">z</script> goes over</td>
    </tr>
    <tr>
      <td><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-166" style="width: 2.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.94em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1001.94em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-167"><span class="msubsup" id="MathJax-Span-168"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-169" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-170"><span class="mrow" id="MathJax-Span-171"><span class="mi" id="MathJax-Span-172" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-173" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-174" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-175" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-31">p_{\rm data}</script></td>
      <td>The (unknown) distribution over our images. This is where our images are sampled from.</td>
    </tr>
    <tr>
      <td><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-176" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-177"><span class="msubsup" id="MathJax-Span-178"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-179" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-180" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-32">p_g</script></td>
      <td>The generative distribution that the generator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-181" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.45em, 1000.78em, 2.5em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-182"><span class="mi" id="MathJax-Span-183" style="font-family: MathJax_Math; font-style: italic;">G</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.968em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">G</script> samples from. We would like for <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-184" style="width: 4.906em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.203em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1004.2em, 2.72em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-185"><span class="msubsup" id="MathJax-Span-186"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-188" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-190" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-191" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-192"><span class="mrow" id="MathJax-Span-193"><span class="mi" id="MathJax-Span-194" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-195" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-196" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-197" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub><mo>=</mo><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-34">p_g=p_{\rm data}</script></td>
    </tr>
  </tbody>
</table>

<p>The discriminator network <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-198" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-199"><span class="mi" id="MathJax-Span-200" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-201" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-203" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-35">D(x)</script> takes some image <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-204" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.54em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-205"><span class="mi" id="MathJax-Span-206" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-36">x</script> on input
and returns the probability that the image <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-207" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.54em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-208"><span class="mi" id="MathJax-Span-209" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-37">x</script> was sampled
from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-210" style="width: 2.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.94em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1001.94em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-211"><span class="msubsup" id="MathJax-Span-212"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-213" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-214"><span class="mrow" id="MathJax-Span-215"><span class="mi" id="MathJax-Span-216" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-217" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-218" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-219" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-38">p_{\rm data}</script>.
The discriminator should return a value closer to 1 when the image
is from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-220" style="width: 2.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.94em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1001.94em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-221"><span class="msubsup" id="MathJax-Span-222"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-223" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-224"><span class="mrow" id="MathJax-Span-225"><span class="mi" id="MathJax-Span-226" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-227" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-228" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-229" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-39">p_{\rm data}</script> and a value closer to 0 when the image is fake,
like an image sampled from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-230" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-231"><span class="msubsup" id="MathJax-Span-232"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-234" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-40">p_g</script>.
In DCGANs, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-235" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-236"><span class="mi" id="MathJax-Span-237" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-239" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-240" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-41">D(x)</script> is a traditional convolutional network.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/discrim-architecture.png" alt=""></p>

  <p class="image-caption">The discriminator convolutional network.
   This image is from the <a href="https://arxiv.org/abs/1607.07539">inpainting paper</a>.</p>

</div>

<p>The goal of training the discriminator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-241" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-242"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-244" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-245" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-246" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-42">D(x)</script> is:</p>

<ol>
  <li>Maximize <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-247" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-248"><span class="mi" id="MathJax-Span-249" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-250" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-251" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-252" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-43">D(x)</script> for every image from the true data distribution
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-253" style="width: 4.529em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.879em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1003.88em, 2.672em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-254"><span class="mi" id="MathJax-Span-255" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-256" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="msubsup" id="MathJax-Span-257" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-258" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-259"><span class="mrow" id="MathJax-Span-260"><span class="mi" id="MathJax-Span-261" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-262" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-263" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-264" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>∼</mo><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-44">x\sim p_{\rm data}</script>.</li>
  <li>Minimize <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-265" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-266"><span class="mi" id="MathJax-Span-267" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-268" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-270" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-45">D(x)</script> for every image not from the true data distribution
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2241;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-271" style="width: 4.529em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.879em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.904em, 1003.88em, 2.888em, -1000em); top: -2.532em; left: 0em;"><span class="mrow" id="MathJax-Span-272"><span class="mi" id="MathJax-Span-273" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-274" style="font-family: MathJax_AMS; padding-left: 0.278em;">≁</span><span class="msubsup" id="MathJax-Span-275" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-276" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-277"><span class="mrow" id="MathJax-Span-278"><span class="mi" id="MathJax-Span-279" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-280" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-281" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-282" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>≁</mo><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-46">x\not\sim p_{\rm data}</script>.</li>
</ol>

<p>The goal of training the generator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-283" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-284"><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-286" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-287" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-288" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-47">G(z)</script> is to
produce samples that fool <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-289" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1000.78em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-290"><span class="mi" id="MathJax-Span-291" style="font-family: MathJax_Math; font-style: italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-48">D</script>.
The output of the generator is an image and can
be used as the input to the discriminator.
Therefore, the generator wants to to maximize <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-292" style="width: 4.205em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.61em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1003.52em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-293"><span class="mi" id="MathJax-Span-294" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-295" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-296" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-297" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-298" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-299" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-300" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-49">D(G(z))</script>,
or equivalently minimize <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-301" style="width: 6.145em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.28em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1005.19em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-302"><span class="mn" id="MathJax-Span-303" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-304" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-305" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">D</span><span class="mo" id="MathJax-Span-306" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-308" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-309" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-310" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-311" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mi>D</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-50">1-D(G(z))</script> because <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-312" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1000.78em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-313"><span class="mi" id="MathJax-Span-314" style="font-family: MathJax_Math; font-style: italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">D</script> is
a probability estimate and only ranges between 0 and 1.</p>

<p>As presented in the paper, training adversarial networks is
done with the following
<a href="https://en.wikipedia.org/wiki/Minimax">minimax game</a>.
The <a href="https://en.wikipedia.org/wiki/Expected_value">expectations</a>
in the first term go over the samples from the true data distribution
and over samples from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-315" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-316"><span class="msubsup" id="MathJax-Span-317"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-318" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-319" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-52">p_z</script> in the second term, which goes over
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-320" style="width: 4.96em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.256em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1004.26em, 2.773em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-321"><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-323" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-324" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-325" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-326" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="msubsup" id="MathJax-Span-327" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-328" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-329" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 1.337em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>∼</mo><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-53">G(z)\sim p_g</script>.</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;munder&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/munder&gt;&lt;munder&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-330" style="width: 25.541em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.983em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1021.86em, 3.259em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-331"><span class="munderover" id="MathJax-Span-332"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(3.156em, 1001.65em, 4.149em, -1000em); top: -3.987em; left: 0em;"><span class="mo" id="MathJax-Span-333" style="font-family: MathJax_Main;">min</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.327em, 1000.54em, 4.264em, -1000em); top: -3.322em; left: 0.556em;"><span class="mi" id="MathJax-Span-334" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">G</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="munderover" id="MathJax-Span-335" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.861em; height: 0px;"><span style="position: absolute; clip: rect(3.377em, 1001.85em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.342em, 1000.57em, 4.249em, -1000em); top: -3.326em; left: 0.638em;"><span class="mi" id="MathJax-Span-337" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">D</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-338" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 3.078em; height: 0px;"><span style="position: absolute; clip: rect(3.142em, 1000.64em, 4.15em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-339"><span class="mrow" id="MathJax-Span-340"><span class="texatom" id="MathJax-Span-341"><span class="mrow" id="MathJax-Span-342"><span class="mi" id="MathJax-Span-343" style="font-family: MathJax_AMS;">E</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.667em;"><span class="texatom" id="MathJax-Span-344"><span class="mrow" id="MathJax-Span-345"><span class="mi" id="MathJax-Span-346" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-347" style="font-size: 70.7%; font-family: MathJax_Main;">∼</span><span class="msubsup" id="MathJax-Span-348"><span style="display: inline-block; position: relative; width: 1.381em; height: 0px;"><span style="position: absolute; clip: rect(3.513em, 1000.35em, 4.286em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-349" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.356em;"><span class="texatom" id="MathJax-Span-350"><span class="mrow" id="MathJax-Span-351"><span class="mi" id="MathJax-Span-352" style="font-size: 50%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-353" style="font-size: 50%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-354" style="font-size: 50%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-355" style="font-size: 50%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mi" id="MathJax-Span-356" style="font-family: MathJax_Main; padding-left: 0.167em;">log</span><span class="mo" id="MathJax-Span-357"></span><span class="mi" id="MathJax-Span-358" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">D</span><span class="mo" id="MathJax-Span-359" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-360" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-361" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-362" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-363" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 2.266em; height: 0px;"><span style="position: absolute; clip: rect(3.142em, 1000.64em, 4.15em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-364"><span class="mrow" id="MathJax-Span-365"><span class="texatom" id="MathJax-Span-366"><span class="mrow" id="MathJax-Span-367"><span class="mi" id="MathJax-Span-368" style="font-family: MathJax_AMS;">E</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.667em;"><span class="texatom" id="MathJax-Span-369"><span class="mrow" id="MathJax-Span-370"><span class="mi" id="MathJax-Span-371" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-372" style="font-size: 70.7%; font-family: MathJax_Main;">∼</span><span class="msubsup" id="MathJax-Span-373"><span style="display: inline-block; position: relative; width: 0.643em; height: 0px;"><span style="position: absolute; clip: rect(3.513em, 1000.35em, 4.286em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-374" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.356em;"><span class="mi" id="MathJax-Span-375" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-376" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-377" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-378"></span><span class="mo" id="MathJax-Span-379" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-380" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-381" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-382" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">D</span><span class="mo" id="MathJax-Span-383" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-384" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-385" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-386" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-387" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-388" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-389" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-390" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.968em; border-left: 0px solid; width: 0px; height: 1.901em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><munder><mo movablelimits="true" form="prefix">min</mo><mi>G</mi></munder><munder><mo movablelimits="true" form="prefix">max</mo><mi>D</mi></munder><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">E</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mo>∼</mo><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></mrow></msub><mi>log</mi><mo>⁡</mo><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">E</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi>z</mi><mo>∼</mo><msub><mi>p</mi><mi>z</mi></msub></mrow></msub><mo stretchy="false">[</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-54">\min_G \max_D {\mathbb E}_{x\sim p_{\rm data}} \log D(x) +
                {\mathbb E}_{z\sim p_z}[\log (1-D(G(z)))]</script>

<p>We will train <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-391" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1000.78em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-392"><span class="mi" id="MathJax-Span-393" style="font-family: MathJax_Math; font-style: italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">D</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-394" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.45em, 1000.78em, 2.5em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-395"><span class="mi" id="MathJax-Span-396" style="font-family: MathJax_Math; font-style: italic;">G</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.968em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">G</script> by taking the gradients of
this expression with respect to their parameters.
We know how to quickly compute every part of this expression.
The expectations are approximated in minibatches of size <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-397" style="width: 1.35em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1001.06em, 2.672em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-398"><span class="mi" id="MathJax-Span-399" style="font-family: MathJax_Math; font-style: italic;">m</span><span class="mo" id="MathJax-Span-400" style="font-family: MathJax_Main;">,</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mo>,</mo></math></span></span><script type="math/tex" id="MathJax-Element-57">m,</script>
and the inner maximization can be approximated with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-401" style="width: 0.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.539em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.461em, 1000.52em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-402"><span class="mi" id="MathJax-Span-403" style="font-family: MathJax_Math; font-style: italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.943em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-58">k</script>
gradient steps. It turns out <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-404" style="width: 2.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.317em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.461em, 1002.24em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-405"><span class="mi" id="MathJax-Span-406" style="font-family: MathJax_Math; font-style: italic;">k</span><span class="mo" id="MathJax-Span-407" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-408" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.943em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-59">k=1</script> works well for training.</p>

<p>Let <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-409" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.92em, 2.474em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-410"><span class="msubsup" id="MathJax-Span-411"><span style="display: inline-block; position: relative; width: 0.914em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.46em, 4.159em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-412" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.469em;"><span class="mi" id="MathJax-Span-413" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.245em; border-left: 0px solid; width: 0px; height: 1.125em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-60">\theta_d</script> be the parameters of the discriminator
and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-414" style="width: 1.026em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.862em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.86em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-415"><span class="msubsup" id="MathJax-Span-416"><span style="display: inline-block; position: relative; width: 0.883em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.46em, 4.159em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-417" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.469em;"><span class="mi" id="MathJax-Span-418" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-61">\theta_g</script> be the parameters the generator.
The gradients of the loss with respect to
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-419" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.92em, 2.474em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-420"><span class="msubsup" id="MathJax-Span-421"><span style="display: inline-block; position: relative; width: 0.914em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.46em, 4.159em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-422" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.469em;"><span class="mi" id="MathJax-Span-423" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.245em; border-left: 0px solid; width: 0px; height: 1.125em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-62">\theta_d</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-424" style="width: 1.026em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.862em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.86em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-425"><span class="msubsup" id="MathJax-Span-426"><span style="display: inline-block; position: relative; width: 0.883em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.46em, 4.159em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-427" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.469em;"><span class="mi" id="MathJax-Span-428" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-63">\theta_g</script> can be computed with
<a href="https://en.wikipedia.org/wiki/Backpropagation">backpropagation</a>
because <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-429" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1000.78em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-430"><span class="mi" id="MathJax-Span-431" style="font-family: MathJax_Math; font-style: italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-64">D</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-432" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.45em, 1000.78em, 2.5em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-433"><span class="mi" id="MathJax-Span-434" style="font-family: MathJax_Math; font-style: italic;">G</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.968em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">G</script> are defined by well-understood neural network components.
Here’s the training algorithm from the
<a href="http://papers.nips.cc/paper/5423-generative-adversarial">GAN paper</a>.
Ideally once this is finished, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-435" style="width: 4.906em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.203em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.659em, 1004.2em, 2.72em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-436"><span class="msubsup" id="MathJax-Span-437"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-438" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-439" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-440" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-441" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-442" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-443"><span class="mrow" id="MathJax-Span-444"><span class="mi" id="MathJax-Span-445" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-446" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-447" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-448" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub><mo>=</mo><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-66">p_g=p_{\rm data}</script>, so <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-449" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-450"><span class="mi" id="MathJax-Span-451" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-452" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-453" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-454" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-67">G(z)</script> will
be able to produce new samples from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-455" style="width: 2.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.94em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1001.94em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-456"><span class="msubsup" id="MathJax-Span-457"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-458" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-459"><span class="mrow" id="MathJax-Span-460"><span class="mi" id="MathJax-Span-461" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-462" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-463" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-464" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-68">p_{\rm data}</script>.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/gan-training.png" alt=""></p>

  <p class="image-caption">GAN training algorithm from the
   <a href="http://papers.nips.cc/paper/5423-generative-adversarial">GAN paper</a>.</p>

</div>

<h3 id="existing-gan-and-dcgan-implementations">Existing GAN and DCGAN implementations<a class="anchorjs-link " href="#existing-gan-and-dcgan-implementations" aria-label="Anchor link for: existing gan and dcgan implementations" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>There are many great GAN and DCGAN implementations on GitHub
you can browse:</p>

<ul>
  <li><a href="https://github.com/goodfeli/adversarial">goodfeli/adversarial</a>:
Theano GAN implementation released by the authors of the GAN paper.</li>
  <li><a href="https://github.com/tqchen/mxnet-gan">tqchen/mxnet-gan</a>:
Unofficial MXNet GAN implementation.</li>
  <li><a href="https://github.com/Newmu/dcgan_code">Newmu/dcgan_code</a>:
Theano DCGAN implementation released by the authors of the DCGAN paper.</li>
  <li><a href="https://github.com/soumith/dcgan.torch">soumith/dcgan.torch</a>:
Torch DCGAN implementation by one of the authors (Soumith Chintala)
of the DCGAN paper.</li>
  <li><a href="https://github.com/carpedm20/DCGAN-tensorflow">carpedm20/DCGAN-tensorflow</a>:
Unofficial TensorFlow DCGAN implementation.</li>
  <li><a href="https://github.com/openai/improved-gan">openai/improved-gan</a>:
Code behind <a href="https://arxiv.org/abs/1606.03498">OpenAI’s first paper</a>.
Extensively modifies <code class="highlighter-rouge">carpedm20/DCGAN-tensorflow</code>.</li>
  <li><a href="https://github.com/mattya/chainer-DCGAN">mattya/chainer-DCGAN</a>:
Unofficial Chainer DCGAN implementation.</li>
  <li><a href="https://github.com/jacobgil/keras-dcgan">jacobgil/keras-dcgan</a>:
Unofficial (and incomplete) Keras DCGAN implementation.</li>
</ul>

<p>Moving forward, we will build on
<a href="https://github.com/carpedm20/DCGAN-tensorflow">carpedm20/DCGAN-tensorflow</a>.</p>

<h3 id="ml-heavy-dcgans-in-tensorflow">[ML-Heavy] DCGANs in TensorFlow<a class="anchorjs-link " href="#ml-heavy-dcgans-in-tensorflow" aria-label="Anchor link for: ml heavy dcgans in tensorflow" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>The implementation for this portion is in my
<a href="https://github.com/bamos/dcgan-completion.tensorflow">bamos/dcgan-completion.tensorflow</a>
GitHub repository.
I strongly emphasize that the code in this portion is from
Taehoon Kim’s
<a href="https://github.com/carpedm20/DCGAN-tensorflow">carpedm20/DCGAN-tensorflow</a>
repository.
We’ll use my repository here so that we can easily use the
image completion portions in the next section.</p>

<p>The implementation is mostly in a Python class called <code class="highlighter-rouge">DCGAN</code> in
<a href="https://github.com/bamos/dcgan-completion.tensorflow/blob/master/model.py">model.py</a>.
It’s helpful to have everything in a class like this so that
intermediate states can be saved after training and then
loaded for later use.</p>

<p>First let’s define the generator and discriminator architectures.
The <code class="highlighter-rouge">linear</code>, <code class="highlighter-rouge">conv2d_transpose</code>, <code class="highlighter-rouge">conv2d</code>, and <code class="highlighter-rouge">lrelu</code> functions are defined in
<a href="https://github.com/bamos/dcgan-completion.tensorflow/blob/master/ops.py">ops.py</a>.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h0_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h0_b</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gf_dim</span><span class="o">*</span><span class="mi">8</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
                                           <span class="s">'g_h0_lin'</span><span class="p">,</span> <span class="n">with_w</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">h0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gf_dim</span> <span class="o">*</span> <span class="mi">8</span><span class="p">])</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_bn0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h0</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">h1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1_b</span> <span class="o">=</span> <span class="n">conv2d_transpose</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gf_dim</span><span class="o">*</span><span class="mi">4</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">'g_h1'</span><span class="p">,</span> <span class="n">with_w</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_bn1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h1</span><span class="p">))</span>

    <span class="n">h2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_b</span> <span class="o">=</span> <span class="n">conv2d_transpose</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gf_dim</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">'g_h2'</span><span class="p">,</span> <span class="n">with_w</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_bn2</span><span class="p">(</span><span class="n">h2</span><span class="p">))</span>

    <span class="n">h3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h3_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h3_b</span> <span class="o">=</span> <span class="n">conv2d_transpose</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gf_dim</span><span class="o">*</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">'g_h3'</span><span class="p">,</span> <span class="n">with_w</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_bn3</span><span class="p">(</span><span class="n">h3</span><span class="p">))</span>

    <span class="n">h4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h4_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h4_b</span> <span class="o">=</span> <span class="n">conv2d_transpose</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">'g_h4'</span><span class="p">,</span> <span class="n">with_w</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">h4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">discriminator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">reuse</span><span class="p">:</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">get_variable_scope</span><span class="p">()</span><span class="o">.</span><span class="n">reuse_variables</span><span class="p">()</span>

    <span class="n">h0</span> <span class="o">=</span> <span class="n">lrelu</span><span class="p">(</span><span class="n">conv2d</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_dim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'d_h0_conv'</span><span class="p">))</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">lrelu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_bn1</span><span class="p">(</span><span class="n">conv2d</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_dim</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'d_h1_conv'</span><span class="p">)))</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">lrelu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_bn2</span><span class="p">(</span><span class="n">conv2d</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_dim</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'d_h2_conv'</span><span class="p">)))</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">lrelu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_bn3</span><span class="p">(</span><span class="n">conv2d</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_dim</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'d_h3_conv'</span><span class="p">)))</span>
    <span class="n">h4</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8192</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'d_h3_lin'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">h4</span><span class="p">),</span> <span class="n">h4</span></code></pre>
</figure>

<p>When we’re initializing this class, we’ll use these functions to
create the models. We need two versions of the discriminator
that shares (or reuses) parameters. One for the minibatch of
images from the data distribution and the other for the minibatch
of images from the generator.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discriminator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">D_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D_logits_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discriminator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre>
</figure>

<p>Next, we’ll define the loss functions. Instead of using the sums,
we’ll use the
<a href="https://en.wikipedia.org/wiki/Cross_entropy">cross entropy</a>
between <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-465" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1000.78em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-466"><span class="mi" id="MathJax-Span-467" style="font-family: MathJax_Math; font-style: italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">D</script>’s predictions and what we want them to be
because it works better.
The discriminator wants the predictions on the “real” data
to be all ones and the predictions on the “fake” data from
the generator to be all zeros.
The generator wants the discriminator’s predictions to
be all ones.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">d_loss_real</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid_cross_entropy_with_logits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D_logits</span><span class="p">,</span>
                                            <span class="n">tf</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">d_loss_fake</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid_cross_entropy_with_logits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D_logits_</span><span class="p">,</span>
                                            <span class="n">tf</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D_</span><span class="p">)))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">d_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_loss_real</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_loss_fake</span>

<span class="bp">self</span><span class="o">.</span><span class="n">g_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid_cross_entropy_with_logits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D_logits_</span><span class="p">,</span>
                                            <span class="n">tf</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D_</span><span class="p">)))</span></code></pre>
</figure>

<p>Gather the variables for each of the models
so they can be trained separately.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="n">t_vars</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">()</span>

<span class="bp">self</span><span class="o">.</span><span class="n">d_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">t_vars</span> <span class="k">if</span> <span class="s">'d_'</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">g_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">t_vars</span> <span class="k">if</span> <span class="s">'g_'</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span></code></pre>
</figure>

<p>Now we’re ready to optimize the parameters and
we’ll use <a href="https://arxiv.org/abs/1412.6980">ADAM</a>,
which is an adaptive non-convex optimization method
commonly used in modern deep learning.
ADAM is often competitive with SGD and (usually) doesn’t
require hand-tuning of the learning rate, momentum, and
other hyper-parameters.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="n">d_optim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">beta1</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">beta1</span><span class="p">)</span> \
                    <span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_loss</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_vars</span><span class="p">)</span>
<span class="n">g_optim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">beta1</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">beta1</span><span class="p">)</span> \
                    <span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_loss</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">g_vars</span><span class="p">)</span></code></pre>
</figure>

<p>We’re ready to go through our data. In each epoch, we sample
some images in a minibatch and run the optimizers to update
the networks.
Interestingly if <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-468" style="width: 0.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.808em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.45em, 1000.78em, 2.5em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-469"><span class="mi" id="MathJax-Span-470" style="font-family: MathJax_Math; font-style: italic;">G</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.968em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math></span></span><script type="math/tex" id="MathJax-Element-70">G</script> is only updated once, the discriminator’s
loss does not go to zero.
Also, I think the additional calls at the end to <code class="highlighter-rouge">d_loss_fake</code>
and <code class="highlighter-rouge">d_loss_real</code> are causing a little bit of unnecessary computation
and are redundant because these values are computed
as part of <code class="highlighter-rouge">d_optim</code> and <code class="highlighter-rouge">g_optim</code>.
As an exercise in TensorFlow, you can try optimizing this part
and send a PR to the original repo.
(If you do, ping me and I’ll update it in mine too.)</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">epoch</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_idxs</span><span class="p">):</span>
        <span class="n">batch_images</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">batch_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_dim</span><span class="p">])</span> \
                    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c"># Update D network</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">summary_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">d_optim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_sum</span><span class="p">],</span>
            <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span> <span class="n">batch_images</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span> <span class="n">batch_z</span> <span class="p">})</span>

        <span class="c"># Update G network</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">summary_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">g_optim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_sum</span><span class="p">],</span>
            <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span> <span class="n">batch_z</span> <span class="p">})</span>

        <span class="c"># Run g_optim twice to make sure that d_loss does not go to zero</span>
        <span class="c"># (different from paper)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">summary_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">g_optim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_sum</span><span class="p">],</span>
            <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span> <span class="n">batch_z</span> <span class="p">})</span>

        <span class="n">errD_fake</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_loss_fake</span><span class="o">.</span><span class="nb">eval</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span> <span class="n">batch_z</span><span class="p">})</span>
        <span class="n">errD_real</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_loss_real</span><span class="o">.</span><span class="nb">eval</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span> <span class="n">batch_images</span><span class="p">})</span>
        <span class="n">errG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_loss</span><span class="o">.</span><span class="nb">eval</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span> <span class="n">batch_z</span><span class="p">})</span></code></pre>
</figure>

<p>That’s it! Of course the full code has a little more book-keeping
that you can check out in
<a href="https://github.com/bamos/dcgan-completion.tensorflow/blob/master/model.py">model.py</a>.</p>

<h3 id="running-dcgan-on-your-images">Running DCGAN on your images<a class="anchorjs-link " href="#running-dcgan-on-your-images" aria-label="Anchor link for: running dcgan on your images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>
<p>If you skipped the last section, but are interested in running some code:
The implementation for this portion is in my
<a href="https://github.com/bamos/dcgan-completion.tensorflow">bamos/dcgan-completion.tensorflow</a>
GitHub repository.
I strongly emphasize that the code in this portion is from
Taehoon Kim’s
<a href="https://github.com/carpedm20/DCGAN-tensorflow">carpedm20/DCGAN-tensorflow</a>
repository.
We’ll use my repository here so that we can easily use the
image completion portions in the next section.
As a warning, if you don’t have a CUDA-enabled GPU, training the
network in this portion may be prohibitively slow.</p>

<p><strong>Please message me if the following doesn’t work for you!</strong></p>

<p>First let’s clone my
<a href="https://github.com/bamos/dcgan-completion.tensorflow">bamos/dcgan-completion.tensorflow</a>
and
<a href="http://cmusatyalab.github.io/openface">OpenFace</a>
repositories.
We’ll use OpenFace’s Python-only portions to pre-process images.
Don’t worry, you won’t have to install OpenFace’s Torch dependency.
Create a new working directory for this and clone the repositories:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">git clone https://github.com/cmusatyalab/openface.git
git clone https://github.com/bamos/dcgan-completion.tensorflow.git</code></pre>
</figure>

<p>Next, install <a href="http://opencv.org/">OpenCV</a> and <a href="http://dlib.net/">dlib</a>
for Python 2.
(OpenFace currently uses Python 2, but if you’re interested,
I’d be happy if you make it Python 3 compatible and
<a href="https://github.com/cmusatyalab/openface/issues/172">send in a PR mentioning this issue</a>.)
These can a little tricky to get set up and I’ve
included a few notes on what versions I use and how I install
in the <a href="http://cmusatyalab.github.io/openface/setup/">OpenFace setup guide</a>.
Next, install OpenFace’s Python library so we can preprocess images.
If you’re not using a virtual environment, you should use <code class="highlighter-rouge">sudo</code>
when running <code class="highlighter-rouge">setup.py</code> to globally install OpenFace.
(If you have trouble setting up this portion, you can also use
our OpenFace docker build as described
in the <a href="http://cmusatyalab.github.io/openface/setup/">OpenFace setup guide</a>.)</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>openface
pip2 install <span class="nt">-r</span> requirements.txt
python2 setup.py install
models/get-models.sh
<span class="nb">cd</span> ..</code></pre>
</figure>

<p>Next download a dataset of face images. It doesn’t matter if they
have labels or not, we’ll get rid of them.
A non-exhaustive list of options are:
<a href="https://www.microsoft.com/en-us/research/project/msr-image-recognition-challenge-irc/">MS-Celeb-1M</a>,
<a href="http://mmlab.ie.cuhk.edu.hk/projects/CelebA.html">CelebA</a>,
<a href="http://www.cbsr.ia.ac.cn/english/CASIA-WebFace-Database.html">CASIA-WebFace</a>,
<a href="http://vintage.winklerbros.net/facescrub.html">FaceScrub</a>,
<a href="http://vis-www.cs.umass.edu/lfw/">LFW</a>,
and
<a href="http://megaface.cs.washington.edu/">MegaFace</a>.
Place the dataset in <code class="highlighter-rouge">dcgan-completion.tensorflow/data/your-dataset/raw</code>
to indicate it’s the dataset’s raw images.</p>

<p>Now we’ll use OpenFace’s alignment tool to pre-process the images to be 64x64.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">./openface/util/align-dlib.py data/dcgan-completion.tensorflow/data/your-dataset/raw align innerEyesAndBottomLip data/dcgan-completion.tensorflow/data/your-dataset/aligned <span class="nt">--size</span> 64</code></pre>
</figure>

<p>And finally we’ll flatten the aligned images directory so that
it just contains images and no sub-directories.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>dcgan-completion.tensorflow/data/your-dataset/aligned
find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'*.png'</span> <span class="nt">-exec</span> mv <span class="o">{}</span> <span class="nb">.</span> <span class="se">\;</span>
find <span class="nb">.</span> <span class="nt">-type</span> d <span class="nt">-empty</span> <span class="nt">-delete</span>
<span class="nb">cd</span> ../../..</code></pre>
</figure>

<p>We’re ready to train the DCGAN.
After <a href="https://www.tensorflow.org/versions/r0.10/get_started/os_setup.html#download-and-setup">installing TensorFlow</a>,
start the training.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">./train-dcgan.py <span class="nt">--dataset</span> ./data/your-dataset/aligned <span class="nt">--epoch</span> 20</code></pre>
</figure>

<p>You can check what randomly sampled images from the generator look
like in the <code class="highlighter-rouge">samples</code> directory.
I’m training on the CASIA-WebFace and FaceScrub datasets because
I had them on hand. After 14 epochs, the samples from mine look like:</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/dcgan-samples.png" alt=""></p>

  <p class="image-caption">Samples from my DCGAN after training for 14 epochs
   with the combined CASIA-WebFace and FaceScrub dataset.</p>

</div>

<p>You can also view the TensorFlow graphs and loss functions
with <a href="https://www.tensorflow.org/versions/r0.10/how_tos/summaries_and_tensorboard/index.html">TensorBoard</a>.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">tensorboard <span class="nt">--logdir</span> ./logs</code></pre>
</figure>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/dcgan-loss.png" alt=""></p>

  <p class="image-caption">TensorBoard loss visualizations. Will be updated in real-time when training.</p>

</div>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/tensorboard-graph.gif" alt=""></p>

  <p class="image-caption">TensorBoard visualization of DCGAN networks.</p>

</div>

<h2 id="step-3-finding-the-best-fake-image-for-image-completion">Step 3: Finding the best fake image for image completion<a class="anchorjs-link " href="#step-3-finding-the-best-fake-image-for-image-completion" aria-label="Anchor link for: step 3 finding the best fake image for image completion" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>

<h3 id="image-completion-with-dcgans">Image completion with DCGANs<a class="anchorjs-link " href="#image-completion-with-dcgans" aria-label="Anchor link for: image completion with dcgans" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>Now that we have a trained discriminator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-471" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-472"><span class="mi" id="MathJax-Span-473" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-474" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-475" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-476" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-71">D(x)</script> and generator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-477" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-478"><span class="mi" id="MathJax-Span-479" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-480" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-481" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-482" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-72">G(z)</script>,
how can we use them to complete images?
In this section I present the techniques in
Raymond Yeh and Chen Chen et al.’s paper
“<a href="https://arxiv.org/abs/1607.07539">Semantic Image Inpainting with Perceptual and Contextual Losses</a>,”
which was just posted on arXiv on July 26, 2016.</p>

<p>To do completion for some image <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-483" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-484"><span class="mi" id="MathJax-Span-485" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-73">y</script>, something reasonable that
<strong>doesn’t</strong> work is to maximize <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-486" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-487"><span class="mi" id="MathJax-Span-488" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-489" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-490" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-491" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-74">D(y)</script> over the missing pixels.
This will result in something that’s neither from the data
distribution (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-492" style="width: 2.266em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.94em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1001.94em, 2.511em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-493"><span class="msubsup" id="MathJax-Span-494"><span style="display: inline-block; position: relative; width: 1.953em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-495" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="texatom" id="MathJax-Span-496"><span class="mrow" id="MathJax-Span-497"><span class="mi" id="MathJax-Span-498" style="font-size: 70.7%; font-family: MathJax_Main;">d</span><span class="mi" id="MathJax-Span-499" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-500" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-501" style="font-size: 70.7%; font-family: MathJax_Main;">a</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-75">p_{\rm data}</script>) nor the generative distribution (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-502" style="width: 1.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.552em, 1000.92em, 2.612em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-503"><span class="msubsup" id="MathJax-Span-504"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-505" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-506" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.405em; border-left: 0px solid; width: 0px; height: 0.98em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-76">p_g</script>).
What we want is a reasonable projection of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-507" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-508"><span class="mi" id="MathJax-Span-509" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-77">y</script> onto the generative distribution.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/inpainting-projection.png" alt=""></p>

  <p class="image-caption">(a): Ideal reconstruction of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-510" style="width: 0.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.638em, 1000.52em, 2.806em, -1000em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-511"><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.34em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.845em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-78">y</script> onto the generative
   distribution (the blue manifold).
   (b): Failure example of trying to reconstruct <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-513" style="width: 0.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.638em, 1000.52em, 2.806em, -1000em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-514"><span class="mi" id="MathJax-Span-515" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.34em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.845em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">y</script> by only
   maximizing <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-516" style="width: 2.171em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.08em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.33em, 1001.99em, 2.851em, -1000em); top: -2.34em; left: 0em;"><span class="mrow" id="MathJax-Span-517"><span class="mi" id="MathJax-Span-518" style="font-family: MathJax_Math; font-style: italic;">D</span><span class="mo" id="MathJax-Span-519" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-520" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-521" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.34em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.347em; border-left: 0px solid; width: 0px; height: 1.209em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-80">D(y)</script>.
   This image is from the <a href="https://arxiv.org/abs/1607.07539">inpainting paper</a>.</p>

</div>

<h3 id="ml-heavy-loss-function-for-projecting-onto-p_g">[ML-Heavy] Loss function for projecting onto <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-522" style="width: 1.105em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.906em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.607em, 1000.91em, 2.581em, -1000em); top: -2.167em; left: 0em;"><span class="mrow" id="MathJax-Span-523"><span class="msubsup" id="MathJax-Span-524"><span style="display: inline-block; position: relative; width: 0.917em; height: 0px;"><span style="position: absolute; clip: rect(3.459em, 1000.5em, 4.332em, -1000em); top: -4.02em; left: 0em;"><span class="mi" id="MathJax-Span-525" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.87em; left: 0.503em;"><span class="mi" id="MathJax-Span-526" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.167em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.408em; border-left: 0px solid; width: 0px; height: 0.995em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>g</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-81">p_g</script><a class="anchorjs-link " href="#ml-heavy-loss-function-for-projecting-onto-p_g" aria-label="Anchor link for: ml heavy loss function for projecting onto p_g" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>To define a reasonable projection,
let’s first define some notation for completing images.
We use a <em>binary mask</em> <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-527" style="width: 1.242em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.078em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1001.08em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-528"><span class="mi" id="MathJax-Span-529" style="font-family: MathJax_Math; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-82">M</script> that has values 0 or 1.
A value of 1 represents the parts of the image we
want to keep and a value of 0 represents the parts
of the image we want to complete.
We can now define how to complete an image <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-530" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-531"><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-83">y</script> given the
binary mask <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-533" style="width: 1.242em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.078em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1001.08em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-534"><span class="mi" id="MathJax-Span-535" style="font-family: MathJax_Math; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">M</script>. Multiply the elements of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-536" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-537"><span class="mi" id="MathJax-Span-538" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-85">y</script> by the elements
of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-539" style="width: 1.242em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.078em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1001.08em, 2.478em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-540"><span class="mi" id="MathJax-Span-541" style="font-family: MathJax_Math; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.917em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-86">M</script>. The element-wise product between two matrices is
sometimes called the
<a href="https://en.wikipedia.org/wiki/Hadamard_product_(matrices)">Hadamard product</a>
and is represented as <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-542" style="width: 3.182em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.748em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1002.75em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-543"><span class="mi" id="MathJax-Span-544" style="font-family: MathJax_Math; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-545" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-546" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 1.155em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>⊙</mo><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-87">M\odot y</script>.
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-547" style="width: 3.182em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.748em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.472em, 1002.75em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-548"><span class="mi" id="MathJax-Span-549" style="font-family: MathJax_Math; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-550" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-551" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 1.155em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>⊙</mo><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-88">M\odot y</script> gives the original part of the image.</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/mask-example.png" alt=""></p>

  <p class="image-caption">Illustration of a binary mask.</p>

</div>

<p>Next, suppose we’ve found an image from the generator <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-552" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-553"><span class="mi" id="MathJax-Span-554" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-556"><span class="mrow" id="MathJax-Span-557"><span class="munderover" id="MathJax-Span-558"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-559" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-560" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-561" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-89">G(\hat z)</script>
for some <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-562" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.254em, 1000.49em, 2.328em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-563"><span class="texatom" id="MathJax-Span-564"><span class="mrow" id="MathJax-Span-565"><span class="munderover" id="MathJax-Span-566"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-567" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-568" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.996em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-90">\hat z</script> that gives a reasonable reconstruction of
the missing portions.
The completed pixels <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-569" style="width: 7.977em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.843em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1006.75em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-570"><span class="mo" id="MathJax-Span-571" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-572" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-573" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-574" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-575" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-576" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-577" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">G</span><span class="mo" id="MathJax-Span-578" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-579"><span class="mrow" id="MathJax-Span-580"><span class="munderover" id="MathJax-Span-581"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-582" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-583" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-584" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>M</mi><mo stretchy="false">)</mo><mo>⊙</mo><mi>G</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-91">(1-M)\odot G(\hat z)</script> can be added to
the original pixels to create the reconstructed image:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-585" style="width: 19.669em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.918em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1016.82em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-586"><span class="msubsup" id="MathJax-Span-587"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-588" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="texatom" id="MathJax-Span-589"><span class="mrow" id="MathJax-Span-590"><span class="mi" id="MathJax-Span-591" style="font-size: 70.7%; font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-592" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-593" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-594" style="font-size: 70.7%; font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-595" style="font-size: 70.7%; font-family: MathJax_Main;">n</span><span class="mi" id="MathJax-Span-596" style="font-size: 70.7%; font-family: MathJax_Main;">s</span><span class="mi" id="MathJax-Span-597" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-598" style="font-size: 70.7%; font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-599" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-600" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-601" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-602" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-603" style="font-size: 70.7%; font-family: MathJax_Main;">d</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-604" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-605" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-606" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-607" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-608" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-609" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-610" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-611" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-612" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-613" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-614" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-615" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">G</span><span class="mo" id="MathJax-Span-616" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-617"><span class="mrow" id="MathJax-Span-618"><span class="munderover" id="MathJax-Span-619"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-620" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-621" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-622" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>=</mo><mi>M</mi><mo>⊙</mo><mi>y</mi><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>M</mi><mo stretchy="false">)</mo><mo>⊙</mo><mi>G</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-92">x_{\rm reconstructed} = M\odot y + (1-M)\odot G(\hat z)</script>

<p>Now all we need to do is find some <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-623" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-624"><span class="mi" id="MathJax-Span-625" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-626" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-627"><span class="mrow" id="MathJax-Span-628"><span class="munderover" id="MathJax-Span-629"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-630" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-631" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-632" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-93">G(\hat z)</script> that does a good
job at completing the image.
To find <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-633" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.254em, 1000.49em, 2.328em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-634"><span class="texatom" id="MathJax-Span-635"><span class="mrow" id="MathJax-Span-636"><span class="munderover" id="MathJax-Span-637"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-638" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-639" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.996em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-94">\hat z</script>, let’s revisit our goals of recovering <strong>contextual</strong>
and <strong>perceptual</strong> information from the beginning of this post
and pose them in the context of DCGANs.
We’ll do this by defining <a href="https://en.wikipedia.org/wiki/Loss_function">loss functions</a>
for an arbitrary <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x223C;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-640" style="width: 3.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.694em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1002.69em, 2.672em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-641"><span class="mi" id="MathJax-Span-642" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-643" style="font-family: MathJax_Main; padding-left: 0.278em;">∼</span><span class="msubsup" id="MathJax-Span-644" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.909em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.343em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-645" style="font-family: MathJax_Math; font-style: italic;">p</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.503em;"><span class="mi" id="MathJax-Span-646" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.288em; border-left: 0px solid; width: 0px; height: 0.863em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>∼</mo><msub><mi>p</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-95">z\sim p_z</script>.
A smaller value of these loss functions means that <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-647" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-648"><span class="mi" id="MathJax-Span-649" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-96">z</script> is
more suitable for completion than a larger value.</p>

<p><strong>Contextual Loss</strong>: To keep the same context as the input image,
make sure the known pixel locations in the input image <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-650" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-651"><span class="mi" id="MathJax-Span-652" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-97">y</script>
are similar to the pixels in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-653" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-654"><span class="mi" id="MathJax-Span-655" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-656" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-657" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-658" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-98">G(z)</script>.
We need to penalize <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-659" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-660"><span class="mi" id="MathJax-Span-661" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-662" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-663" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-664" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-99">G(z)</script> for not creating a similar image for
the pixels that we know about.
Formally, we do this by element-wise subtracting the pixels in
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-665" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-666"><span class="mi" id="MathJax-Span-667" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-100">y</script> from <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-668" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-669"><span class="mi" id="MathJax-Span-670" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-671" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-672" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-673" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-101">G(z)</script> and looking at how much they differ:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;x&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-674" style="width: 19.291em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.595em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1016.53em, 2.763em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-675"><span class="msubsup" id="MathJax-Span-676"><span style="display: inline-block; position: relative; width: 4.006em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.66em, 4.171em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-677"><span class="mrow" id="MathJax-Span-678"><span class="texatom" id="MathJax-Span-679"><span class="mrow" id="MathJax-Span-680"><span class="mi" id="MathJax-Span-681" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.69em;"><span class="texatom" id="MathJax-Span-682"><span class="mrow" id="MathJax-Span-683"><span class="mi" id="MathJax-Span-684" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-685" style="font-size: 70.7%; font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-686" style="font-size: 70.7%; font-family: MathJax_Main;">n</span><span class="mi" id="MathJax-Span-687" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-688" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-689" style="font-size: 70.7%; font-family: MathJax_Main;">x</span><span class="mi" id="MathJax-Span-690" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-691" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-692" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-693" style="font-size: 70.7%; font-family: MathJax_Main;">l</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-694" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-695" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-696" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-697" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="texatom" id="MathJax-Span-698" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-699"><span class="mo" id="MathJax-Span-700" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-701"><span class="mrow" id="MathJax-Span-702"><span class="mo" id="MathJax-Span-703" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-704" style="font-family: MathJax_Math; font-style: italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-705" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-706" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">G</span><span class="mo" id="MathJax-Span-707" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-708" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-709" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-710" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-711" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-712" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-713" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="texatom" id="MathJax-Span-714"><span class="mrow" id="MathJax-Span-715"><span class="mo" id="MathJax-Span-716" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-717"><span style="display: inline-block; position: relative; width: 0.707em; height: 0px;"><span style="position: absolute; clip: rect(3.075em, 1000.16em, 4.398em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-718"><span class="mrow" id="MathJax-Span-719"><span class="mo" id="MathJax-Span-720" style="font-family: MathJax_Main;">|</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.703em; left: 0.278em;"><span class="mn" id="MathJax-Span-721" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-722" style="font-family: MathJax_Main;">,</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.392em; border-left: 0px solid; width: 0px; height: 1.325em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>M</mi><mo>⊙</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>−</mo><mi>M</mi><mo>⊙</mo><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>1</mn></msub><mo>,</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-102">{\mathcal L}_{\rm contextual}(z) = ||M\odot G(z) - M\odot y||_1,</script>

<p>where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-723" style="width: 7.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.412em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1006.29em, 2.772em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-724"><span class="texatom" id="MathJax-Span-725"><span class="mrow" id="MathJax-Span-726"><span class="mo" id="MathJax-Span-727" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-728"><span class="mrow" id="MathJax-Span-729"><span class="mo" id="MathJax-Span-730" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-731" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="texatom" id="MathJax-Span-732"><span class="mrow" id="MathJax-Span-733"><span class="mo" id="MathJax-Span-734" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-735"><span style="display: inline-block; position: relative; width: 0.707em; height: 0px;"><span style="position: absolute; clip: rect(3.075em, 1000.16em, 4.398em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-736"><span class="mrow" id="MathJax-Span-737"><span class="mo" id="MathJax-Span-738" style="font-family: MathJax_Main;">|</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.703em; left: 0.278em;"><span class="mn" id="MathJax-Span-739" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-740" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-741" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.075em, 1001em, 4.399em, -1000em); top: -3.987em; left: 0em;"><span class="mo" id="MathJax-Span-742" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.702em; left: 1.056em;"><span class="mi" id="MathJax-Span-743" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="texatom" id="MathJax-Span-744" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-745"><span class="mo" id="MathJax-Span-746" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-747"><span style="display: inline-block; position: relative; width: 0.891em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-748" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="mi" id="MathJax-Span-749" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="texatom" id="MathJax-Span-750"><span class="mrow" id="MathJax-Span-751"><span class="mo" id="MathJax-Span-752" style="font-family: MathJax_Main;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.403em; border-left: 0px solid; width: 0px; height: 1.335em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>1</mn></msub><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>x</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-103">||x||_1=\sum_i |x_i|</script> is the
<a href="https://en.wikipedia.org/wiki/Norm_(mathematics)#Taxicab_norm_or_Manhattan_norm"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x2113;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-753" style="width: 1.026em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.862em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.86em, 2.467em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-754"><span class="msubsup" id="MathJax-Span-755"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.4em, 4.169em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-756" style="font-family: MathJax_Main;">ℓ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.417em;"><span class="mn" id="MathJax-Span-757" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 1.117em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>ℓ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-104">\ell_1</script> norm</a>
of some vector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-758" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.54em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-759"><span class="mi" id="MathJax-Span-760" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-105">x</script>.
The <a href="https://en.wikipedia.org/wiki/Norm_(mathematics)#Euclidean_norm"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x2113;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-761" style="width: 1.026em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.862em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.86em, 2.467em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-762"><span class="msubsup" id="MathJax-Span-763"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.4em, 4.169em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-764" style="font-family: MathJax_Main;">ℓ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.417em;"><span class="mn" id="MathJax-Span-765" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 1.117em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>ℓ</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-106">\ell_2</script> norm</a>
is another reasonable choice, but the inpainting paper says
that the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x2113;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-766" style="width: 1.026em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.862em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.289em, 1000.86em, 2.467em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-767"><span class="msubsup" id="MathJax-Span-768"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.4em, 4.169em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-769" style="font-family: MathJax_Main;">ℓ</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.417em;"><span class="mn" id="MathJax-Span-770" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.236em; border-left: 0px solid; width: 0px; height: 1.117em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>ℓ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-107">\ell_1</script> norm works better in practice.</p>

<p>In the ideal case, all of the pixels at known locations are
the same between <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-771" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-772"><span class="mi" id="MathJax-Span-773" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-108">y</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-774" style="width: 2.373em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.047em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1001.95em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-775"><span class="mi" id="MathJax-Span-776" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-777" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-778" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-779" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-109">G(z)</script>.
Then <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-780" style="width: 7.223em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.196em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1006.16em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-781"><span class="mi" id="MathJax-Span-782" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-783" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-784" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-785"><span style="display: inline-block; position: relative; width: 0.708em; height: 0px;"><span style="position: absolute; clip: rect(3.075em, 1000.29em, 4.399em, -1000em); top: -3.987em; left: 0em;"><span class="mo" id="MathJax-Span-786" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.389em;"><span class="mi" id="MathJax-Span-787" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-788" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-789" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.809em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.5em, 4.354em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-790" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.49em;"><span class="mi" id="MathJax-Span-791" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-792" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-793" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><msub><mo stretchy="false">)</mo><mi>i</mi></msub><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-110">G(z)_i - y_i = 0</script> for the known pixels <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-794" style="width: 0.38em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.323em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.494em, 1000.28em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-795"><span class="mi" id="MathJax-Span-796" style="font-family: MathJax_Math; font-style: italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.905em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-111">i</script> and thus
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;x&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-797" style="width: 8.192em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.058em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1007.02em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-798"><span class="msubsup" id="MathJax-Span-799"><span style="display: inline-block; position: relative; width: 4.006em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.66em, 4.171em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-800"><span class="mrow" id="MathJax-Span-801"><span class="texatom" id="MathJax-Span-802"><span class="mrow" id="MathJax-Span-803"><span class="mi" id="MathJax-Span-804" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.69em;"><span class="texatom" id="MathJax-Span-805"><span class="mrow" id="MathJax-Span-806"><span class="mi" id="MathJax-Span-807" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-808" style="font-size: 70.7%; font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-809" style="font-size: 70.7%; font-family: MathJax_Main;">n</span><span class="mi" id="MathJax-Span-810" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-811" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-812" style="font-size: 70.7%; font-family: MathJax_Main;">x</span><span class="mi" id="MathJax-Span-813" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-814" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-815" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-816" style="font-size: 70.7%; font-family: MathJax_Main;">l</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-817" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-818" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-819" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-820" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-821" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-112">{\mathcal L}_{\rm contextual}(z) = 0</script>.</p>

<p><strong>Perceptual Loss</strong>: To recover an image that looks real,
let’s make sure the discriminator is properly convinced
that the image looks real.
We’ll do this with the same criterion used in training
the DCGAN:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-822" style="width: 16.059em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.847em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1013.75em, 2.766em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-823"><span class="msubsup" id="MathJax-Span-824"><span style="display: inline-block; position: relative; width: 3.989em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.66em, 4.171em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-825"><span class="mrow" id="MathJax-Span-826"><span class="texatom" id="MathJax-Span-827"><span class="mrow" id="MathJax-Span-828"><span class="mi" id="MathJax-Span-829" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.69em;"><span class="texatom" id="MathJax-Span-830"><span class="mrow" id="MathJax-Span-831"><span class="mi" id="MathJax-Span-832" style="font-size: 70.7%; font-family: MathJax_Main;">p</span><span class="mi" id="MathJax-Span-833" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-834" style="font-size: 70.7%; font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-835" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-836" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-837" style="font-size: 70.7%; font-family: MathJax_Main;">p</span><span class="mi" id="MathJax-Span-838" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-839" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-840" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-841" style="font-size: 70.7%; font-family: MathJax_Main;">l</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-842" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-843" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-844" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-845" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-846" style="font-family: MathJax_Main; padding-left: 0.278em;">log</span><span class="mo" id="MathJax-Span-847"></span><span class="mo" id="MathJax-Span-848" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-849" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-850" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-851" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">D</span><span class="mo" id="MathJax-Span-852" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-853" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-854" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-855" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-856" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-857" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-858" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.396em; border-left: 0px solid; width: 0px; height: 1.328em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-113">{\mathcal L}_{\rm perceptual}(z) = \log (1 - D(G(z)))</script>

<hr>

<p>We’re finally ready to find <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-859" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.254em, 1000.49em, 2.328em, -1000em); top: -2.155em; left: 0em;"><span class="mrow" id="MathJax-Span-860"><span class="texatom" id="MathJax-Span-861"><span class="mrow" id="MathJax-Span-862"><span class="munderover" id="MathJax-Span-863"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-864" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-865" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.155em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.996em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-114">\hat z</script> with a combination of the
contextual and perceptual losses:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2261;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;x&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-866" style="width: 17.998em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.517em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1015.42em, 2.766em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-867"><span class="texatom" id="MathJax-Span-868"><span class="mrow" id="MathJax-Span-869"><span class="texatom" id="MathJax-Span-870"><span class="mrow" id="MathJax-Span-871"><span class="mi" id="MathJax-Span-872" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span class="mo" id="MathJax-Span-873" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-874" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-875" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-876" style="font-family: MathJax_Main; padding-left: 0.278em;">≡</span><span class="msubsup" id="MathJax-Span-877" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 4.006em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.66em, 4.171em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-878"><span class="mrow" id="MathJax-Span-879"><span class="texatom" id="MathJax-Span-880"><span class="mrow" id="MathJax-Span-881"><span class="mi" id="MathJax-Span-882" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.69em;"><span class="texatom" id="MathJax-Span-883"><span class="mrow" id="MathJax-Span-884"><span class="mi" id="MathJax-Span-885" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-886" style="font-size: 70.7%; font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-887" style="font-size: 70.7%; font-family: MathJax_Main;">n</span><span class="mi" id="MathJax-Span-888" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-889" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-890" style="font-size: 70.7%; font-family: MathJax_Main;">x</span><span class="mi" id="MathJax-Span-891" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-892" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-893" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-894" style="font-size: 70.7%; font-family: MathJax_Main;">l</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-895" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-896" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-897" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-898" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-899" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">λ</span><span class="msubsup" id="MathJax-Span-900"><span style="display: inline-block; position: relative; width: 3.989em; height: 0px;"><span style="position: absolute; clip: rect(3.12em, 1000.66em, 4.171em, -1000em); top: -3.987em; left: 0em;"><span class="texatom" id="MathJax-Span-901"><span class="mrow" id="MathJax-Span-902"><span class="texatom" id="MathJax-Span-903"><span class="mrow" id="MathJax-Span-904"><span class="mi" id="MathJax-Span-905" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.69em;"><span class="texatom" id="MathJax-Span-906"><span class="mrow" id="MathJax-Span-907"><span class="mi" id="MathJax-Span-908" style="font-size: 70.7%; font-family: MathJax_Main;">p</span><span class="mi" id="MathJax-Span-909" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-910" style="font-size: 70.7%; font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-911" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-912" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-913" style="font-size: 70.7%; font-family: MathJax_Main;">p</span><span class="mi" id="MathJax-Span-914" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-915" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-916" style="font-size: 70.7%; font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-917" style="font-size: 70.7%; font-family: MathJax_Main;">l</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-918" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-919" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-920" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.396em; border-left: 0px solid; width: 0px; height: 1.328em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>≡</mo><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>+</mo><mi>λ</mi><msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-115">{\mathcal L}(z) \equiv {\mathcal L}_{\rm contextual}(z) + \lambda {\mathcal L}_{\rm perceptual}(z)</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2261;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;/mrow&gt;&lt;munder&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-921" style="width: 8.354em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.166em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1007.07em, 3.186em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-922"><span class="texatom" id="MathJax-Span-923"><span class="mrow" id="MathJax-Span-924"><span class="munderover" id="MathJax-Span-925"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-926" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-927" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-928" style="font-family: MathJax_Main; padding-left: 0.278em;">≡</span><span class="texatom" id="MathJax-Span-929" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-930"><span class="mi" id="MathJax-Span-931" style="font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-932" style="font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-933" style="font-family: MathJax_Main;">g</span></span></span><span class="munderover" id="MathJax-Span-934" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.667em; height: 0px;"><span style="position: absolute; clip: rect(3.156em, 1001.65em, 4.149em, -1000em); top: -3.987em; left: 0em;"><span class="mo" id="MathJax-Span-935" style="font-family: MathJax_Main;">min</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.513em, 1000.33em, 4.256em, -1000em); top: -3.387em; left: 0.668em;"><span class="mi" id="MathJax-Span-936" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="texatom" id="MathJax-Span-937" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-938"><span class="texatom" id="MathJax-Span-939"><span class="mrow" id="MathJax-Span-940"><span class="mi" id="MathJax-Span-941" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span class="mo" id="MathJax-Span-942" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-943" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-944" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.884em; border-left: 0px solid; width: 0px; height: 1.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo>≡</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi></mrow><munder><mo movablelimits="true" form="prefix">min</mo><mi>z</mi></munder><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-116">\hat z \equiv {\rm arg} \min_z {\mathcal L}(z)</script>

<p>where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-945" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.593em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.461em, 1000.57em, 2.49em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-946"><span class="mi" id="MathJax-Span-947" style="font-family: MathJax_Math; font-style: italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.944em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-117">\lambda</script> is a hyper-parameter that controls how import the
contextual loss is relative to the perceptual loss.
(I use <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-948" style="width: 3.666em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.125em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.461em, 1003.05em, 2.5em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-949"><span class="mi" id="MathJax-Span-950" style="font-family: MathJax_Math; font-style: italic;">λ</span><span class="mo" id="MathJax-Span-951" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-952" style="font-family: MathJax_Main; padding-left: 0.278em;">0.1</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.956em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>λ</mi><mo>=</mo><mn>0.1</mn></math></span></span><script type="math/tex" id="MathJax-Element-118">\lambda=0.1</script> by default and haven’t played with it too much.)
Then as before, the reconstructed image fills in the missing
values of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-953" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.683em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-954"><span class="mi" id="MathJax-Span-955" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.3em; border-left: 0px solid; width: 0px; height: 0.876em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-119">y</script> with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-956" style="width: 2.535em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.155em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1002.06em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-957"><span class="mi" id="MathJax-Span-958" style="font-family: MathJax_Math; font-style: italic;">G</span><span class="mo" id="MathJax-Span-959" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-960"><span class="mrow" id="MathJax-Span-961"><span class="munderover" id="MathJax-Span-962"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-963" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-964" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-965" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-120">G(\hat z)</script>:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2299;&lt;/mo&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-966" style="width: 19.669em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.918em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1016.82em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-967"><span class="msubsup" id="MathJax-Span-968"><span style="display: inline-block; position: relative; width: 4.819em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.52em, 4.16em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-969" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.572em;"><span class="texatom" id="MathJax-Span-970"><span class="mrow" id="MathJax-Span-971"><span class="mi" id="MathJax-Span-972" style="font-size: 70.7%; font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-973" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-974" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-975" style="font-size: 70.7%; font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-976" style="font-size: 70.7%; font-family: MathJax_Main;">n</span><span class="mi" id="MathJax-Span-977" style="font-size: 70.7%; font-family: MathJax_Main;">s</span><span class="mi" id="MathJax-Span-978" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-979" style="font-size: 70.7%; font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-980" style="font-size: 70.7%; font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-981" style="font-size: 70.7%; font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-982" style="font-size: 70.7%; font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-983" style="font-size: 70.7%; font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-984" style="font-size: 70.7%; font-family: MathJax_Main;">d</span></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="mo" id="MathJax-Span-985" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-986" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-987" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-988" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-989" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-990" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mn" id="MathJax-Span-991" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-992" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-993" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.081em;"></span></span><span class="mo" id="MathJax-Span-994" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-995" style="font-family: MathJax_Main; padding-left: 0.222em;">⊙</span><span class="mi" id="MathJax-Span-996" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">G</span><span class="mo" id="MathJax-Span-997" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-998"><span class="mrow" id="MathJax-Span-999"><span class="munderover" id="MathJax-Span-1000"><span style="display: inline-block; position: relative; width: 0.583em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1000.47em, 4.16em, -1000em); top: -3.987em; left: 0.016em;"><span class="mi" id="MathJax-Span-1001" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; clip: rect(3.131em, 1000.39em, 3.618em, -1000em); top: -4.033em; left: 0.083em;"><span class="mo" id="MathJax-Span-1002" style="font-family: MathJax_Main;">^</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-1003" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>=</mo><mi>M</mi><mo>⊙</mo><mi>y</mi><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>M</mi><mo stretchy="false">)</mo><mo>⊙</mo><mi>G</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>z</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-121">x_{\rm reconstructed} = M\odot y + (1-M)\odot G(\hat z)</script>

<p>The inpainting paper also uses
<a href="http://dl.acm.org/citation.cfm?id=882269">poisson blending</a>
(<a href="http://www.ctralie.com/Teaching/PoissonImageEditing/">see Chris Traile’s post for an introduction to it</a>)
to smooth the reconstructed image.</p>

<h3 id="ml-heavy-tensorflow-implementation-of-image-completion-with-dcgans">[ML-Heavy] TensorFlow implementation of image completion with DCGANs<a class="anchorjs-link " href="#ml-heavy-tensorflow-implementation-of-image-completion-with-dcgans" aria-label="Anchor link for: ml heavy tensorflow implementation of image completion with dcgans" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>This section presents the changes I’ve added to
<a href="https://github.com/bamos/dcgan-completion.tensorflow">bamos/dcgan-completion.tensorflow</a>
that modifies Taehoon Kim’s
<a href="https://github.com/carpedm20/DCGAN-tensorflow">carpedm20/DCGAN-tensorflow</a>
for image completion.</p>

<p>We can re-use a lot of the existing variables for completion.
The only new variable we’ll add is a mask for completion:</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'mask'</span><span class="p">)</span></code></pre>
</figure>

<p>We’ll solve <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;/mrow&gt;&lt;munder&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1004" style="width: 6.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.711em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1005.62em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-1005"><span class="texatom" id="MathJax-Span-1006"><span class="mrow" id="MathJax-Span-1007"><span class="mi" id="MathJax-Span-1008" style="font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-1009" style="font-family: MathJax_Main;">r</span><span class="mi" id="MathJax-Span-1010" style="font-family: MathJax_Main;">g</span></span></span><span class="munderover" id="MathJax-Span-1011" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.073em; height: 0px;"><span style="position: absolute; clip: rect(3.156em, 1001.65em, 4.149em, -1000em); top: -3.987em; left: 0em;"><span class="mo" id="MathJax-Span-1012" style="font-family: MathJax_Main;">min</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 1.667em;"><span class="mi" id="MathJax-Span-1013" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1014" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-1015"><span class="texatom" id="MathJax-Span-1016"><span class="mrow" id="MathJax-Span-1017"><span class="mi" id="MathJax-Span-1018" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span class="mo" id="MathJax-Span-1019" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1020" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1021" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi></mrow><munder><mo movablelimits="true" form="prefix">min</mo><mi>z</mi></munder><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-122">{\rm arg} \min_z {\mathcal L}(z)</script> iteratively with
gradient descent with the gradients <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1022" style="width: 3.72em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.179em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.405em, 1003.08em, 2.728em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-1023"><span class="msubsup" id="MathJax-Span-1024"><span style="display: inline-block; position: relative; width: 1.239em; height: 0px;"><span style="position: absolute; clip: rect(3.142em, 1000.79em, 4.182em, -1000em); top: -3.987em; left: 0em;"><span class="mi" id="MathJax-Span-1025" style="font-family: MathJax_Main;">∇</span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span><span style="position: absolute; top: -3.837em; left: 0.833em;"><span class="mi" id="MathJax-Span-1026" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.987em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1027"><span class="mrow" id="MathJax-Span-1028"><span class="texatom" id="MathJax-Span-1029"><span class="mrow" id="MathJax-Span-1030"><span class="mi" id="MathJax-Span-1031" style="font-family: MathJax_Caligraphic;">L</span></span></span></span></span><span class="mo" id="MathJax-Span-1032" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1033" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1034" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mi>z</mi></msub><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">L</mi></mrow></mrow><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-123">\nabla_z {\mathcal L}(z)</script>.
TensorFlow’s <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">automatic differentiation</a>
can compute this for us once we’ve defined the loss functions!
So the entire idea of completion with DCGANs can be implemented by just
adding four lines of TensorFlow code to an existing DCGAN implementation.
(Of course implementing this also involves some non-TensorFlow code.)</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">contextual_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">))),</span> <span class="mi">1</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">perceptual_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_loss</span>
<span class="bp">self</span><span class="o">.</span><span class="n">complete_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextual_loss</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">perceptual_loss</span>
<span class="bp">self</span><span class="o">.</span><span class="n">grad_complete_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gradients</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">complete_loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span></code></pre>
</figure>

<p>Next, let’s define a mask. I’ve only added one for the center portions
of images, but feel free to add something else like a random mask
and send in a pull request.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">maskType</span> <span class="o">==</span> <span class="s">'center'</span><span class="p">:</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">scale</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_shape</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">scale</span><span class="p">))</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">l</span><span class="p">:</span><span class="n">u</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span><span class="n">u</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span></code></pre>
</figure>

<p>For gradient descent, we’ll use
<a href="http://www.stats.ox.ac.uk/~lienart/blog_opti_pgd.html">projected gradient descent</a>
with minibatches and momentum to project <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1035" style="width: 0.595em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.485em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.713em, 1000.49em, 2.489em, -1000em); top: -2.317em; left: 0em;"><span class="mrow" id="MathJax-Span-1036"><span class="mi" id="MathJax-Span-1037" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.317em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.65em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-124">z</script> to be in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1038" style="width: 3.128em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.694em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.351em, 1002.58em, 2.675em, -1000em); top: -2.263em; left: 0em;"><span class="mrow" id="MathJax-Span-1039"><span class="mo" id="MathJax-Span-1040" style="font-family: MathJax_Main;">[</span><span class="mo" id="MathJax-Span-1041" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1042" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1043" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1044" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-1045" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.263em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.352em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-125">[-1,1]</script>.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_idxs</span><span class="p">):</span>
    <span class="n">batch_images</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">batch_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_shape</span><span class="p">)</span>
    <span class="n">zhats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_dim</span><span class="p">))</span>

    <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">nIter</span><span class="p">):</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span> <span class="n">zhats</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span> <span class="n">batch_mask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span> <span class="n">batch_images</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">run</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">complete_loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_complete_loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">]</span>
        <span class="n">loss</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">G_imgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="n">fd</span><span class="p">)</span>

        <span class="n">v_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">momentum</span><span class="o">*</span><span class="n">v</span> <span class="o">-</span> <span class="n">config</span><span class="o">.</span><span class="n">lr</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zhats</span> <span class="o">+=</span> <span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">momentum</span> <span class="o">*</span> <span class="n">v_prev</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span><span class="o">*</span><span class="n">v</span>
        <span class="n">zhats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">zhats</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></code></pre>
</figure>

<h3 id="completing-your-images">Completing your images<a class="anchorjs-link " href="#completing-your-images" aria-label="Anchor link for: completing your images" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h3>

<p>Select some images to complete and place them in
<code class="highlighter-rouge">dcgan-completion.tensorflow/your-test-data/raw</code>.
Align them as before as
<code class="highlighter-rouge">dcgan-completion.tensorflow/your-test-data/aligned</code>.
I randomly selected images from the LFW for this.
My DCGAN wasn’t trained on any of the identities in the LFW.</p>

<p>You can run the completion on your images with:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">./complete.py ./data/your-test-data/aligned/<span class="k">*</span> <span class="nt">--outDir</span> outputImages</code></pre>
</figure>

<p>This will run and periodically output the completed images to <code class="highlighter-rouge">--outDir</code>.
You can create create a gif from these with ImageMagick:</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>outputImages
convert <span class="nt">-delay</span> 10 <span class="nt">-loop</span> 0 completed/<span class="k">*</span>.png completion.gif</code></pre>
</figure>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/completion.gif" alt=""></p>

  <p class="image-caption">
    Final image completions.
    The centers of these images are being automatically generated.
    The source code to create this is available <a href="http://github.com/bamos/dcgan-completion.tensorflow">here</a>.
    <strong>These are not curated!</strong> I selected a random subset of images
    from the LFW dataset.</p>

</div>

<h2 id="conclusion">Conclusion<a class="anchorjs-link " href="#conclusion" aria-label="Anchor link for: conclusion" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>

<p>Thanks for reading, we made it!
In this blog post, we covered one method of completing images that:</p>

<ol>
  <li><a href="#step-1-interpreting-images-as-samples-from-a-probability-distribution">Interprets images as being samples from a probability distribution</a>.</li>
  <li><a href="#step-2-quickly-generating-fake-images">Generates fake images</a>.</li>
  <li><a href="#step-3-using-fake-image-generation-for-image-completion">Finds the best fake image for completion</a>.</li>
</ol>

<p>My examples were on faces, but DCGANs can be trained on other
types of images too.
In general, GANs are difficult to train and we don’t yet
know how to train them on certain classes of objects,
<a href="https://www.quora.com/Do-generative-adversarial-networks-always-converge">nor on large images</a>.
However they’re a promising model and I’m excited to
see where GAN research takes us!</p>

<p>Feel free to ping me on Twitter
<a href="https://twitter.com/brandondamos">@brandondamos</a>,
Github <a href="https://github.com/bamos">@bamos</a>,
or <a href="https://bamos.github.io/index.html">elsewhere</a> if you have any comments
or suggestions on this post. Thanks!</p>

<div class="image-wrapper">

  <p><img src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/gan-imagenet.png" alt=""></p>

  <p class="image-caption"> DCGAN samples (left) and improved GAN samples
    (right, not covered in this post) on ImageNet showing
    that we don’t yet understand how to use GANs on
    every type of image.
    This image is from the <a href="https://arxiv.org/abs/1606.03498">improved GAN paper</a>.</p>

</div>

<h2 id="citation-for-this-articleproject">Citation for this article/project<a class="anchorjs-link " href="#citation-for-this-articleproject" aria-label="Anchor link for: citation for this articleproject" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>

<p>Please consider citing this project in your
publications if it helps your research.
The following is a <a href="http://www.bibtex.org/">BibTeX</a>
and plaintext reference.
The BibTeX entry requires the <code class="highlighter-rouge">url</code> LaTeX package.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@misc{amos2016image,
    title        = {{Image Completion with Deep Learning in TensorFlow}},
    author       = {Amos, Brandon},
    howpublished = {\url{http://bamos.github.io/2016/08/09/deep-completion}},
    note         = {Accessed: [Insert date here]}
}

Brandon Amos. Image Completion with Deep Learning in TensorFlow.
http://bamos.github.io/2016/08/09/deep-completion.
Accessed: [Insert date here]
</code></pre></div></div>

<h2 id="partial-bibliography-for-further-reading">Partial bibliography for further reading<a class="anchorjs-link " href="#partial-bibliography-for-further-reading" aria-label="Anchor link for: partial bibliography for further reading" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>
<ul>
  <li>Raymond Yeh and Chen Chen et al.
“<a href="https://arxiv.org/abs/1607.07539">Semantic Image Inpainting with Perceptual and Contextual Losses</a>:”
Paper this post was based on.</li>
  <li>D. Pathak et al.
<a href="https://people.eecs.berkeley.edu/~pathak/context_encoder/">Context Encoders: Feature Learning by Inpainting</a> at CVPR 2016:
Another recent method for inpainting that use similar loss functions
and have released code
on GitHub at <a href="https://github.com/pathak22/context-encoder">pathak22/context-encoder</a>.
This method is less computationally expensive than Yeh and Chen et al.
because they use a single forward network pass instead of
solving an optimization problem that involves many
forward and backward passes.</li>
  <li>Ian Goodfellow et al.
“<a href="http://papers.nips.cc/paper/5423-generative-adversarial">Generative Adversarial Nets</a>”</li>
  <li>Vincent Dumoulin and Francesco Visin.
“<a href="https://arxiv.org/abs/1603.07285">A guide to convolution arithmetic for deep learning</a>”</li>
  <li>Alec Radford, Luke Metz, and Soumith Chintala.
“<a href="https://arxiv.org/abs/1511.06434">Unsupervised Representation Learning with Deep Convolutional Generative Adversarial Networks</a>”</li>
  <li>Emily Denton et al.
“<a href="http://arxiv.org/abs/1506.05751">Deep Generative Image Models using a Laplacian Pyramid of Adversarial Networks</a>:”
Paper behind <a href="http://soumith.ch/eyescream/">the EyeScream Project</a>.</li>
  <li>Tim Salimans et al.
“<a href="https://arxiv.org/abs/1606.03498">Improved Techniques for Training GANs</a>:”
OpenAI’s first paper. (Not discussed here.)</li>
</ul>

<h2 id="bonus-incomplete-thoughts-on-tensorflow-and-torch">Bonus: Incomplete Thoughts on TensorFlow and Torch<a class="anchorjs-link " href="#bonus-incomplete-thoughts-on-tensorflow-and-torch" aria-label="Anchor link for: bonus incomplete thoughts on tensorflow and torch" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; line-height: 1; padding-left: 0.375em;"></a></h2>
<p>As a machine learning researcher, I mostly use numpy, Torch,
and TensorFlow in my programs.
<a href="https://vtechworks.lib.vt.edu/bitstream/handle/10919/49672/qnTOMS14.pdf">A few</a>
<a href="http://dl.acm.org/citation.cfm?id=2663525">years</a>
<a href="http://dl.acm.org/citation.cfm?id=2685662">ago</a>,
I used Fortran.
I implemented
<a href="https://cmusatyalab.github.io/openface">OpenFace</a>
as a Python library in numpy that calls into networks
trained with Torch.
Over the past few months, I’ve been using TensorFlow
more seriously and have a few thoughts comparing Torch and TensorFlow.
These are non-exhaustive and from my personal experiences as a user.</p>

<p>If I am misunderstanding something here, please message me and I’ll
add a correction. Due to the fast-paced nature of these
frameworks, it’s easy to not have references to everything.</p>

<ul>
  <li>There are many great collections of tutorials, pre-trained models,
and technologies for both Torch and TensorFlow in projects like
<a href="https://github.com/carpedm20/awesome-torch">awesome-torch</a> and
<a href="https://github.com/jtoy/awesome-tensorflow">awesome-tensorflow</a>.</li>
  <li>I haven’t used <a href="https://github.com/torchnet/torchnet">torchnet</a>,
but it seems promising.</li>
  <li>Torch’s REPL is very nice and I always have it open when I’m
developing in Torch to quickly try out operations.
TensorFlow’s <code class="highlighter-rouge">InteractiveSession</code> is nice, but I find
that trying things out interactively is a little slower
since everything has to be defined symbolically
and initialized in the session.
I much prefer trying quick numpy operations in Python’s REPL
over TensorFlow operations.</li>
  <li>As with a lot of other programming, error messages in TensorFlow
and Torch have their own learning curves.
Debugging TensorFlow usually involves reasoning about the symbolic
constructions while debugging Torch is more concrete.
<a href="https://github.com/torch/nngraph/issues/107">Sometimes the error messages are confusing for me and I send in an issue only to find out that my error was obvious</a>.</li>
  <li>
    <p>Having Python support is critical for my research.
I love the scientific Python programming stack and libraries like
<a href="http://matplotlib.org/">matplotlib</a> and
<a href="http://www.cvxpy.org/en/latest/">cvxpy</a>
that don’t have an equivalent in Lua.
This is why I wrote <a href="http://cmusatyalab.github.io/openface">OpenFace</a>
to use Torch for training the neural network,
but Python for everything else.</p>

    <p>I can easily convert TensorFlow arrays to numpy format and use
them with other Python code, but I have to work hard to do
this with Torch.
When I tried using <a href="https://github.com/htwaijry/npy4th">npy4th</a>,
I found a bug (that I haven’t reported, sorry) that
caused incorrect data to be saved.
<a href="https://github.com/deepmind/torch-hdf5">Torch’s hdf5 bindings</a>
seem to work well and can easily be loaded in Python.
And for smaller things, I just manually write out
logs to a CSV file.</p>

    <p>Torch has some equivalents to Python, like
<a href="https://github.com/torch/gnuplot">gnuplot wrappers</a>
for some plotting, but I prefer the Python alternatives.
There are some Python Torch wrappers like
<a href="https://github.com/hughperkins/pytorch">pytorch</a> or
<a href="https://github.com/imodpasteur/lutorpy">lutorpy</a>
that might make this easier, but I haven’t tried them and
my impression is that they’re not able to cover <em>every</em>
Torch feature that can be done in Lua.</p>
  </li>
  <li>
    <p>In Torch, it’s easy to do very detailed operations on tensors
that can execute on the CPU or GPU.
With TensorFlow, GPU operations need to be implemented symbolically.
In Torch, it’s easy to drop into native C or CUDA
if I need to add calls to a C or CUDA library.
For example, I’ve created (CPU-only) Torch wrappers
around the
<a href="https://github.com/bamos/gurobi.torch">gurobi</a>
and
<a href="https://github.com/bamos/ecos.torch">ecos</a>
C optimization libraries.</p>

    <p>In TensorFlow, dropping into C or CUDA is definitely
possible (and easy) on the CPU through numpy conversions,
but I’m not sure how I would make a native CUDA call.
It’s probably possible, but there are no documentation or
examples on this.</p>
  </li>
  <li>TensorFlow (built-in) and
Torch’s <a href="https://github.com/torch/nngraph">nngraph</a> package
graph constructions are both nice.
In my experiences for complex graphs, TensorFlow is able
to optimize the computations and executes about twice as
fast as Torch.
I love nngraph’s visualizations, they’re much clearer than
TensorBoard’s in my experiences.</li>
  <li><a href="https://www.tensorflow.org/versions/r0.10/how_tos/summaries_and_tensorboard/index.html">TensorBoard</a>
is convenient and okay, but I am currently <strong>not</strong> using it for a few reasons.
(In this post, I only used it because
<a href="https://github.com/carpedm20/DCGAN-tensorflow">carpedm20/DCGAN-tensorflow</a>
uses it.)
The plots are not publication-quality and modifications are
very limited.
For example, it’s (currently) impossible to add a rolling average.
The TensorBoard data is stored in a protobuf format and
<a href="http://stackoverflow.com/questions/36700404/tensorflow-opening-log-data-written-by-summarywriter">there’s currently no documentation or examples on loading the data in my own script</a>.
My current solution is to just write out data to CSV files
and load and plot them with another script.</li>
  <li>I am not surprised to find bugs or missing features in Torch/Lua code.
<a href="https://github.com/torch/torch7/pull/591">Here’s my PR removing an incorrect rank check to the LAPACK potrs call</a>.
<a href="https://github.com/torch/cutorch/pull/364">I also had to add a potrs wrapper for CUDA</a>.
<a href="https://github.com/tflearn/tflearn/pull/221">Sometimes I find minor bugs when using TensorFlow/tflearn</a>,
but not as frequently and they’re usually minor.</li>
  <li>Automatic differentiation in TensorFlow is nice.
I can define my loss with one line of code and then get the gradients with
one more line.
I haven’t used
<a href="https://github.com/twitter/torch-autograd">Torch’s autograd</a> package.</li>
  <li>The Torch and TensorFlow communities are great at keeping up with the
latest deep learning techniques. If a popular idea is released,
Torch and TensorFlow implementations are quickly released.</li>
  <li>Batch normalization is easier to use in Torch and in general
it’s nice to not worry about explicitly defining all of my
trainable variables like in TensorFlow.
<a href="http://tflearn.org/">tflearn</a> makes this a little easier in
TensorFlow, but I still prefer Torch’s way.</li>
  <li>I am not surprised to learn about useful under-documented features
in Torch and TensorFlow by reading through somebody else’s source code
on GitHub.
I described in my <a href="http://bamos.github.io/2016/01/19/openface-0.2.0/">last blog post</a>
that I found a under-documented way to reduce Torch model sizes
in OpenFace.</li>
  <li>I prefer how models can be saved and loaded in Torch by passing
the object to a function that serializes it and saves it to
a single file on disk.
In TensorFlow, saving and loading the graph is still functionally
the same, but a little more involved.
<a href="https://github.com/cmusatyalab/openface/issues/42">Loading Torch models on ARM is possible, but tricky</a>.
I don’t have experience loading TensorFlow models on ARM.</li>
  <li>When using multiple GPUs, setting <code class="highlighter-rouge">cutorch.setDevice</code> programmatically in Torch is
slightly easier than exporting the <code class="highlighter-rouge">CUDA_VISIBLE_DEVICES</code> environment
variable in TensorFlow.</li>
  <li>TensorFlow’s long startup time is a slight annoyance if I want to
quickly debug my code on small examples. In Torch, the startup time
is negligible.</li>
  <li>In Python, I like overriding the process name for long-running experiments
with <a href="https://pypi.python.org/pypi/setproctitle">setproctitle</a> so that
I can remember what’s running when I look at the running processes
on my GPUs or CPUs.
However in Torch/Lua, <a href="https://groups.google.com/forum/#!topic/torch7/nxzcYinc-i8">nobody on the mailing list was able
to help me do this</a>.
I also asked on a Lua IRC channel and somebody tried to help me,
but we weren’t able to figure it out.</li>
  <li>Torch’s <a href="https://github.com/torch/argcheck">argcheck</a> has a
<a href="https://github.com/torch/argcheck/issues/3">serious limitation when functions have more than 9 optional arguments</a>.
In Python, I’d like to start using <a href="http://www.mypy-lang.org/">mypy</a>
for simple argument checking, but I’m not sure how well it
works in practice with scientific Python.</li>
  <li>I wrote
<a href="https://github.com/bamos/gurobi.torch">gurobi</a>
and
<a href="https://github.com/bamos/ecos.torch">ecos</a>
wrappers because there weren’t any
LP or QP solvers in Torch.
To my knowledge there still aren’t any other options.</li>
</ul>


</div>
</div>
</div>


  <script src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/sp.js"></script>
  <script src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/jquery_002.js"></script>
  <script src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/bootstrap.js"></script>
  <script src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/anchor.js"></script>
  <script src="Image%20Completion%20with%20Deep%20Learning%20in%20TensorFlow_files/jquery.js"></script>
  <script type="text/javascript">
   try {
       var snowplowTracker = Snowplow.getTrackerUrl('joule.isr.cs.cmu.edu:8081');
       snowplowTracker.enableLinkTracking();
       snowplowTracker.trackPageView();
   } catch (err) {}

   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-102191838-1', 'auto');
   ga('send', 'pageview');

   $("#toc").toc({
       'headings': 'h2,h3'
   });
   anchors.add('h2,h3');
  </script>




<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: MathJax_AMS, sans-serif;"></div></div></body></html>